<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/images/icons/favicon-16x16.png?v=2.6.2" type="image/png" sizes="16x16"><link rel="icon" href="/images/icons/favicon-32x32.png?v=2.6.2" type="image/png" sizes="32x32"><meta name="description" content="Aegis招新题-crypto-writeup        Ccc                      Kinoko的代码 I       源代码： 12345678910111213141516171819202122232425from math import sqrtdef is_prime(n):    if n &lt; 2:">
<meta property="og:type" content="article">
<meta property="og:title" content="Aegis招新题-crypto-writeup">
<meta property="og:url" content="https://freeman-cc.github.io/2022/04/10/Aegis%E6%8B%9B%E6%96%B0%E9%A2%98-crypto-writeup/index.html">
<meta property="og:site_name" content="Cc&#39;s Blog">
<meta property="og:description" content="Aegis招新题-crypto-writeup        Ccc                      Kinoko的代码 I       源代码： 12345678910111213141516171819202122232425from math import sqrtdef is_prime(n):    if n &lt; 2:">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-04-10T06:00:50.000Z">
<meta property="article:modified_time" content="2022-04-10T06:03:21.228Z">
<meta property="article:author" content="Cc">
<meta property="article:tag" content="Crypto">
<meta name="twitter:card" content="summary"><title>Aegis招新题-crypto-writeup | Cc's Blog</title><link ref="canonical" href="https://freeman-cc.github.io/2022/04/10/Aegis%E6%8B%9B%E6%96%B0%E9%A2%98-crypto-writeup/"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.6.2"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  assistSearch: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":true,"scrollDownIcon":false},
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"default","highlight":"light","wordWrap":false},
  reward: false,
  fancybox: false,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: undefined,
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"复制","copySuccess":"复制成功","copyError":"复制失败"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="Cc's Blog" type="application/atom+xml">
</head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">首页</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">归档</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/tags/"><span class="header-nav-menu-item__icon"><i class="fas fa-tags"></i></span><span class="header-nav-menu-item__text">标签</span></a></div></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">Cc's Blog</div><div class="header-banner-info__subtitle">Welcome to my blog, have a nice day!</div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content" id="content"><!-- Just used to judge whether it is an article page--><div id="is-post"></div><div class="post"><header class="post-header"><h1 class="post-title">Aegis招新题-crypto-writeup</h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2022-04-10</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新于</span><span class="post-meta-item__value">2022-04-10</span></span></div></header><div class="post-body">
        <h1 id="Aegis招新题-crypto-writeup"   >
          <a href="#Aegis招新题-crypto-writeup" class="heading-link"><i class="fas fa-link"></i></a><a href="#Aegis招新题-crypto-writeup" class="headerlink" title="Aegis招新题-crypto-writeup"></a>Aegis招新题-crypto-writeup</h1>
      <blockquote>
<p>Ccc</p>
</blockquote>

        <h2 id="Kinoko的代码-I"   >
          <a href="#Kinoko的代码-I" class="heading-link"><i class="fas fa-link"></i></a><a href="#Kinoko的代码-I" class="headerlink" title="Kinoko的代码 I"></a>Kinoko的代码 I</h2>
      <p>源代码：</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> sqrt</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_prime</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>, <span class="built_in">int</span>(sqrt(n+<span class="number">1</span>)+<span class="number">1</span>), <span class="number">2</span>):</span><br><span class="line">        <span class="keyword">if</span> n % i == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">next_prime</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> is_prime(n):</span><br><span class="line">            <span class="built_in">print</span>(n)</span><br><span class="line">            <span class="keyword">return</span> n</span><br><span class="line">        n += <span class="number">2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">seed = <span class="number">0x5eed</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">    seed &lt;&lt;= <span class="number">16</span></span><br><span class="line">    seed += <span class="number">1</span></span><br><span class="line">    seed = next_prime(seed)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Flag is Aegis&#123;%s&#125;&quot;</span> % (<span class="built_in">hex</span>(seed)[-<span class="number">32</span>:]))</span><br></pre></td></tr></table></div></figure>
<p>读完代码后发现是让改进素数判别函数，降低时间复杂度，直接将原函数注释掉，调用gmpy2的is_prime函数即可（偷懒了，题目应该是想考察Miller-Rabin素性检测算法）</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> is_prime</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">next_prime</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> is_prime(n):</span><br><span class="line">            <span class="built_in">print</span>(n)</span><br><span class="line">            <span class="keyword">return</span> n</span><br><span class="line">        n += <span class="number">2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">seed = <span class="number">0x5eed</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">    seed &lt;&lt;= <span class="number">16</span></span><br><span class="line">    seed += <span class="number">1</span></span><br><span class="line">    seed = next_prime(seed)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Flag is Aegis&#123;%s&#125;&quot;</span> % (<span class="built_in">hex</span>(seed)[-<span class="number">32</span>:]))</span><br></pre></td></tr></table></div></figure>

        <h2 id="Kinoko的代码-II"   >
          <a href="#Kinoko的代码-II" class="heading-link"><i class="fas fa-link"></i></a><a href="#Kinoko的代码-II" class="headerlink" title="Kinoko的代码 II"></a>Kinoko的代码 II</h2>
      <p>源代码：</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">phi</span>(<span class="params">n</span>):</span><br><span class="line">	<span class="keyword">if</span> n &lt;= <span class="number">1</span>:</span><br><span class="line">		<span class="keyword">return</span> n</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, n + <span class="number">1</span>):</span><br><span class="line">		<span class="keyword">if</span> n % i == <span class="number">0</span>:</span><br><span class="line">			ans = <span class="number">1</span></span><br><span class="line">			<span class="keyword">while</span> n % i == <span class="number">0</span>:</span><br><span class="line">				n //= i</span><br><span class="line">				ans *= i</span><br><span class="line">			ans //= i</span><br><span class="line">			ans *= i - <span class="number">1</span></span><br><span class="line">			<span class="keyword">return</span> ans * phi(n)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">common</span>(<span class="params">x, y</span>):</span><br><span class="line">	<span class="keyword">if</span> x &gt; y:</span><br><span class="line">		x, y = y, x</span><br><span class="line">	i = <span class="number">2</span></span><br><span class="line">	ans = <span class="number">1</span></span><br><span class="line">	<span class="keyword">while</span> i &lt;= x:</span><br><span class="line">		<span class="keyword">while</span> x % i == <span class="number">0</span> <span class="keyword">and</span> y % i == <span class="number">0</span>:</span><br><span class="line">			x //= i</span><br><span class="line">			y //= i</span><br><span class="line">			ans *= i</span><br><span class="line">		i += <span class="number">1</span></span><br><span class="line">	<span class="keyword">return</span> ans</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">i, n</span>):</span><br><span class="line">	<span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, phi(n)):</span><br><span class="line">		<span class="keyword">if</span> <span class="built_in">pow</span>(i, j, n) == <span class="number">1</span>:</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n = <span class="number">67108934</span></span><br><span class="line">total = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">pow</span>(i, phi(n), n) == <span class="number">1</span> <span class="keyword">and</span> common(i, n) == <span class="number">1</span> <span class="keyword">and</span> check(i, n):</span><br><span class="line">		<span class="built_in">print</span>(i)</span><br><span class="line">		total += i</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> (<span class="string">&quot;Flag is Aegis&#123;%d&#125;&quot;</span> % (total))</span><br></pre></td></tr></table></div></figure>
<p>首先分析代码：</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">phi(n)<span class="comment"># 计算n的欧拉函数值</span></span><br><span class="line">common(x, y)<span class="comment"># 计算x, y的最大公因数</span></span><br><span class="line">check(i, n)<span class="comment"># 判断i是否是n的原根</span></span><br></pre></td></tr></table></div></figure>
<p>分析完代码可以知道题目是让求$n = 67108934$的所有原根的和</p>
<p><strong>这里需要用到原根的数学知识</strong></p>
<blockquote>
<p>最小原根是不大于 $\sqrt[4]{m}$ 级别的。</p>
<p>因此，不妨枚举$ [1, \sqrt[4]{m}] $的整数，得到最小原根 g。</p>
<p>再枚举 $g^s$ 的指数 $s$，若 $s$ 与 $φ(m)$ 互质，则$g^smodm$ 为一个原根。</p>
<p>由此可知，如果数 $m$ 存在原根，则原根的个数为 φ(φ(m))</p>
</blockquote>
<p>首先枚举求得n最小的原根为7</p>
<p>然后遍历求和即可</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> gcd</span><br><span class="line"></span><br><span class="line">n = <span class="number">67108934</span></span><br><span class="line">total = <span class="number">0</span></span><br><span class="line">phin = <span class="number">33554466</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, phin):</span><br><span class="line">    <span class="keyword">if</span> gcd(i, phin) == <span class="number">1</span>:</span><br><span class="line">        total += <span class="built_in">pow</span>(<span class="number">7</span>, i, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Flag is Aegis&#123;%d&#125;&quot;</span> % total)</span><br></pre></td></tr></table></div></figure>

        <h2 id="Kinoko的代码-III"   >
          <a href="#Kinoko的代码-III" class="heading-link"><i class="fas fa-link"></i></a><a href="#Kinoko的代码-III" class="headerlink" title="Kinoko的代码 III"></a>Kinoko的代码 III</h2>
      <p>源代码：</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">P = <span class="number">0x7fffffff</span></span><br><span class="line">Q = <span class="number">0x100</span></span><br><span class="line">n = <span class="number">0x100</span></span><br><span class="line">a = [(i ** (i ** i)) % P <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n)]</span><br><span class="line">res = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> product(a, repeat=<span class="number">8</span>):</span><br><span class="line">    <span class="keyword">if</span> reduce(add, x) % Q == <span class="number">0</span>:</span><br><span class="line">        res += reduce(mul, x)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Flag is Aegis&#123;%d&#125;&quot;</span> % (res % (P * Q)))</span><br></pre></td></tr></table></div></figure>
<p>尝试用快速幂计算出了a，后面的部分就没有思路了，感觉跟 $GF(2^m)$ 有关。</p>

        <h2 id="Kinoko的代码-IV"   >
          <a href="#Kinoko的代码-IV" class="heading-link"><i class="fas fa-link"></i></a><a href="#Kinoko的代码-IV" class="headerlink" title="Kinoko的代码 IV"></a>Kinoko的代码 IV</h2>
      <p>源代码：</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">msg = <span class="string">b&#x27;......&#x27;</span></span><br><span class="line">g = <span class="number">23</span></span><br><span class="line">p = <span class="number">335215034881592512312398694238485179340610060759881511231472142277527176340784432381542726029524727833039074808456839870641607412102746854257629226877248337002993023452385472058106944014653401647033456174126976474875859099023703472904735779212010820524934972736276889281087909166017427905825553503050645575935980580803899122224368875197728677516907272452047278523846912786938173456942568602502013001099009776563388736434564541041529106817380347284002060811645842312648498340150736573246893588079033524476111268686138924892091575797329915240849862827621736832883215569687974368499436632617425922744658912248644475097139485785819369867604176912652851123185884810544172785948158330991257118563772736929105360124222843930130347670027236797458715653361366862282591170630650344062377644570729478796795124594909835004189813214758026703689710017334501371279295621820181402191463184275851324378938021156631501330660825566054528793444353</span></span><br><span class="line">x = bytes_to_long(msg)</span><br><span class="line">h = <span class="built_in">pow</span>(g,x,p)</span><br><span class="line"><span class="built_in">print</span>(h)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">179956689939799978686596162623009071834749620910632881129570185702597885675366053746660084250822996742213156358846254579536681385720261821941496018561712101559148720253943504890341017743734982584598207516433225345830605843249917382020797858837178839235576965252932584506546764681169682067451758822339982991607788445472451090172187831874941209496749224595861824389402308122683468407022055642183997505151642262281735659513608920324853368172095765041692780083964849712368477052130574239545836322863774186581648844719904538237553913580382934907373884521762228204915991345935021715751152215665694954681931730050491031883519789246541180580522272095192525557554130071875996891173839573092163026966683532806284169788149085982141065261043806380173094680150058915109078775560035635889930619074748416389716690011996098383845646464047453083163083103550738288711630170975733999017234569638947005463854359023927470291784650805324521819096823</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></div></figure>
<p>考察离散对数求解的知识，直接调用sage中的$discrete_log()$函数求解x，再转换为bytes即可</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">from Crypto.Util.number import *</span><br><span class="line"></span><br><span class="line">c = 179956689939799978686596162623009071834749620910632881129570185702597885675366053746660084250822996742213156358846254579536681385720261821941496018561712101559148720253943504890341017743734982584598207516433225345830605843249917382020797858837178839235576965252932584506546764681169682067451758822339982991607788445472451090172187831874941209496749224595861824389402308122683468407022055642183997505151642262281735659513608920324853368172095765041692780083964849712368477052130574239545836322863774186581648844719904538237553913580382934907373884521762228204915991345935021715751152215665694954681931730050491031883519789246541180580522272095192525557554130071875996891173839573092163026966683532806284169788149085982141065261043806380173094680150058915109078775560035635889930619074748416389716690011996098383845646464047453083163083103550738288711630170975733999017234569638947005463854359023927470291784650805324521819096823</span><br><span class="line">m = 23</span><br><span class="line">n = 335215034881592512312398694238485179340610060759881511231472142277527176340784432381542726029524727833039074808456839870641607412102746854257629226877248337002993023452385472058106944014653401647033456174126976474875859099023703472904735779212010820524934972736276889281087909166017427905825553503050645575935980580803899122224368875197728677516907272452047278523846912786938173456942568602502013001099009776563388736434564541041529106817380347284002060811645842312648498340150736573246893588079033524476111268686138924892091575797329915240849862827621736832883215569687974368499436632617425922744658912248644475097139485785819369867604176912652851123185884810544172785948158330991257118563772736929105360124222843930130347670027236797458715653361366862282591170630650344062377644570729478796795124594909835004189813214758026703689710017334501371279295621820181402191463184275851324378938021156631501330660825566054528793444353</span><br><span class="line">d=discrete_log(c,mod(m,n))</span><br><span class="line">msg = long_to_bytes(d)</span><br><span class="line">print(msg)</span><br></pre></td></tr></table></div></figure>

        <h2 id="notRSA"   >
          <a href="#notRSA" class="heading-link"><i class="fas fa-link"></i></a><a href="#notRSA" class="headerlink" title="notRSA"></a>notRSA</h2>
      <p>源代码：</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, bytes_to_long</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">n = p * q</span><br><span class="line">flag = <span class="string">b&#x27;Aegis&#123;......&#125;&#x27;</span></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">c = <span class="built_in">pow</span>(m, <span class="number">2</span>, n)</span><br><span class="line"><span class="built_in">print</span>(p**<span class="number">3</span>+q**<span class="number">3</span>)</span><br><span class="line"><span class="built_in">print</span>(p*q-p-q)</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = 9294245038014495018370025503838233837842445450717112861530019994089208464544256432365138864858019427603469395634623982915723003321692974199306043896395471</span></span><br><span class="line"><span class="comment"># q = 12342761514228429158263998414220938515337038241757334937761557332062702646597784278541920751268963691194708568191829119140194036616936954532285327408748239</span></span><br><span class="line"><span class="comment">#2683207403901766067825485634185601766409570143649318199140952968037512600470579376068383383524815864039841298998044483348310172352574406995610031363899276749157640097193160488032526253335175497216620520711500711141110234147693948098688349034232723537263489946840300271580577412796742296691684971450119145954769829625063379511509190333209177419150804570514746916533943674944751821667853376532291018641849933876951962902976903371221223111423718945634451076584248030</span></span><br><span class="line"><span class="comment">#114716649959013852657615268840231124447472690710601678501437134218521741792245535933871147569266364478277891322010833300443127314646898434178369690377612566380887447356076682596113975161733897245200003941284379586690945264751249879210669330319947878473291341185035678293547495739763970613403135670992913681859</span></span><br><span class="line"><span class="comment">#23588520303183909632881265716945062770267850520083979450971468612710595466903076931312046174728593508895307445955963477450821781428035995913285067064035796132808196500567866710084350514597397699053074465810242481186367241</span></span><br></pre></td></tr></table></div></figure>
<p>读代码后发现 $e=2$, 很明显的 $Rabin$ 加密，利用题目中给出的 $p^3+q^3$ 和 $pq-p-q$ 联立方程解出 $p, q$ 即可</p>
<p>公式推导如下：</p>
<script type="math/tex; mode=display">
\begin{aligned}
&\begin{aligned}
p^3 + q^3 &= (p+q)(p^2+q^2-pq)\\
    &=(p+q)[(p+q)^2-3pq]\\
    &=(p+q)^3-3(p+q)*pq
\end{aligned}\\
&pq-p-q=pq -(p+q)\\
\\
&令a = p+q, b= pq可以列出方程组:\\

&\left\{
\begin{aligned}
&a^3 - 3ab = p^3 + q^3\\
&b -a = pq-(p+q)
\end{aligned}
\right.\\
\\
&解出a,b后我们可以继续列出如下方程:\\
&x^2 - ax + b = 0\\
&方程的两根即为p,q


\end{aligned}</script><p>求解 $p, q$ 的代码如下：（此处设$a = p^3+q^3,b = pq-p-q$)</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sympy <span class="keyword">as</span> sp</span><br><span class="line">a = <span class="number">2683207403901766067825485634185601766409570143649318199140952968037512600470579376068383383524815864039841298998044483348310172352574406995610031363899276749157640097193160488032526253335175497216620520711500711141110234147693948098688349034232723537263489946840300271580577412796742296691684971450119145954769829625063379511509190333209177419150804570514746916533943674944751821667853376532291018641849933876951962902976903371221223111423718945634451076584248030</span></span><br><span class="line">b = <span class="number">114716649959013852657615268840231124447472690710601678501437134218521741792245535933871147569266364478277891322010833300443127314646898434178369690377612566380887447356076682596113975161733897245200003941284379586690945264751249879210669330319947878473291341185035678293547495739763970613403135670992913681859</span></span><br><span class="line">p = [<span class="number">1</span>, -<span class="number">3</span>, -<span class="number">3</span>*b, -a]</span><br><span class="line"></span><br><span class="line">x = sp.Symbol(<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">f = x**<span class="number">3</span> + p[<span class="number">1</span>]*x**<span class="number">2</span> + p[<span class="number">2</span>]*x + p[<span class="number">3</span>]</span><br><span class="line">s = sp.solve(f)</span><br><span class="line"><span class="comment"># print(s[0])</span></span><br><span class="line"></span><br><span class="line">pq = s[<span class="number">0</span>]+b</span><br><span class="line">q = [<span class="number">1</span>, -s[<span class="number">0</span>], pq]</span><br><span class="line">y = sp.Symbol(<span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">g = y**<span class="number">2</span> + q[<span class="number">1</span>]*y + q[<span class="number">2</span>]</span><br><span class="line">solve = sp.solve(g)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;p = &#x27;</span> + <span class="built_in">str</span>(solve[<span class="number">0</span>]))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;q = &#x27;</span> + <span class="built_in">str</span>(solve[<span class="number">1</span>]))</span><br></pre></td></tr></table></div></figure>
<p>运行后解出$p,q$</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p = <span class="number">9294245038014495018370025503838233837842445450717112861530019994089208464544256432365138864858019427603469395634623982915723003321692974199306043896395471</span></span><br><span class="line">q = <span class="number">12342761514228429158263998414220938515337038241757334937761557332062702646597784278541920751268963691194708568191829119140194036616936954532285327408748239</span></span><br></pre></td></tr></table></div></figure>
<p>接下来将 $p,q$ 代入进行 $Rabin$ 解密即可</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">e = <span class="number">2</span></span><br><span class="line">c = <span class="number">23588520303183909632881265716945062770267850520083979450971468612710595466903076931312046174728593508895307445955963477450821781428035995913285067064035796132808196500567866710084350514597397699053074465810242481186367241</span></span><br><span class="line">p = <span class="number">9294245038014495018370025503838233837842445450717112861530019994089208464544256432365138864858019427603469395634623982915723003321692974199306043896395471</span></span><br><span class="line">q = <span class="number">12342761514228429158263998414220938515337038241757334937761557332062702646597784278541920751268963691194708568191829119140194036616936954532285327408748239</span></span><br><span class="line">n = p*q</span><br><span class="line">u = <span class="built_in">pow</span>(c, (p+<span class="number">1</span>)//<span class="number">4</span>, p)</span><br><span class="line">v = <span class="built_in">pow</span>(c, (q+<span class="number">1</span>)//<span class="number">4</span>, q)</span><br><span class="line"><span class="comment">#   sp+tq=1</span></span><br><span class="line">s = gmpy2.invert(p, q)   <span class="comment"># (p^-1) mod q</span></span><br><span class="line">t = gmpy2.invert(q, p)   <span class="comment"># (q^-1) mod p</span></span><br><span class="line">x = (t*q*u+s*p*v) % n</span><br><span class="line">y = (t*q*u-s*p*v) % n</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">b&#x27;m1 = &#x27;</span> + long_to_bytes(x % n))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">b&#x27;m2 = &#x27;</span> + long_to_bytes((-x) % n))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">b&#x27;m3 = &#x27;</span> + long_to_bytes(y % n))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">b&#x27;m4 = &#x27;</span> + long_to_bytes((-y) % n))</span><br></pre></td></tr></table></div></figure>
<p>得到结果如下，m3即为flag</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">b&#x27;m1 = kg\xe1\xe8u\x8b\x8b\xda\x04&gt;\xd8z&lt;l\xeby\xd9,1&lt;\x81\xc4\x1d0\x1e\xd8=\x82k\x1cr\x8bzP\x03S\xa1)\xf6\xf2\xdf\x87\xa8\x92\xfd\xf00\xfc\xf5(\xb3\x9e\xa3N\x87~\xf2\xab\xcdr\x1e\x04\xac\xaa\xdc\x90U\x0c\xdeC\x00\xe5oy\xb9\xc9\x1e~\xa5\x01=2\x86O\xbd&#125;\xc4\x1f8\x04g\x8c\xc2\x7f\xae\xf2 wX\xb1\xda#\\\xce\xb0\xde[\xf4\xd0\xe9MN\xb8\x93\xc4\xef\x17%g\xaf\x96I*\xdd\x9a\xc2\x8ec&#x27;</span><br><span class="line">b&#x27;m2 = 7\xf4\xc5\xad!6\x99\x9dO\xd6\xd6\xce?\x89\x02\xdc\xa8\x11\xb11\xb6Lga\xee\x89\x18n\xd8\x845\xb5\x922\x81\xa3\x01\x81\xbe3X\xd5E*\x1b\xc1o\xe4\x00\x04W\xfe\x88\xb8$\xadO\xd7\x9d\xc4\xcb\xee\xcd\x9a\xf0T\xc4\x18\x10\xc9#\x95f\xb01\xe9&#125;\x0b\x80u\xf4g\xd9\x92\xf0\x1bl\x8bd\xde\xcay\xc2Hj\xdb\x11&#125;[\xa1\xef\x86\xbf\xa2\xd3\xdf\xb5\x99\xe7\x13\rg\xe9\xc0*\xefO~\x87\x84\xf4V6\xef\x04\xbd\x8c\xfe&#x27;</span><br><span class="line">b&#x27;m3 = Aegis&#123;This_is_RABIN_not_RSA_though_similarity&#125;&#x27;</span><br><span class="line">b&#x27;m4 = \xa3\\\xa7\x95\x96\xc2%wT\x15\xafH&#123;\xf5\xeeV\x81=\xe2n8\x10\x84\x92\raU\xf1C\xa0\xa8A\x0c\x82\x84\xf6\xa2\xab\xb5&amp;8\\\xed\xbd\x19\xb1\xa0\xe0\xf5-\x0b\x9d,\x06\xac,B\x83k6\xe9\xf3zE\xcc\xe5\x19$\xef\x0c$z\xd6)\xeb\xb2\x9b\x8a%w1\x9a\x1e&#125;F/\xbd/Hz\xc8\x93%^\xa6m\xdf\xb3r\n&#123;J\xae\x02\x10^\xbf;v\x9c\xe6N2\xde\x88v\x070\x85\xc7!3\x00Z6\x0b\xa1\xe4&#x27;</span><br></pre></td></tr></table></div></figure>

        <h2 id="LFSR"   >
          <a href="#LFSR" class="heading-link"><i class="fas fa-link"></i></a><a href="#LFSR" class="headerlink" title="LFSR"></a>LFSR</h2>
      <p>源代码：</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">flag = <span class="string">b&quot;Aegis&#123;????????????????????????&#125;&quot;</span></span><br><span class="line"><span class="keyword">assert</span>(<span class="built_in">len</span>(flag)) == <span class="number">31</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parity</span>(<span class="params">x</span>):  <span class="comment"># 检验二进制x中1的个数，奇为1，偶为0</span></span><br><span class="line">    res = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> x:</span><br><span class="line">        x -= x &amp; (-x)</span><br><span class="line">        res ^= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LFSR</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, init, mask, length</span>):</span><br><span class="line">        <span class="keyword">assert</span>((mask &amp; (<span class="number">1</span> &lt;&lt; (length - <span class="number">1</span>))) != <span class="number">0</span>)</span><br><span class="line">        self.init = init</span><br><span class="line">        self.length = length</span><br><span class="line">        self.lengthmask = <span class="number">2</span> ** length - <span class="number">1</span></span><br><span class="line">        self.mask = mask &amp; self.lengthmask</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">next</span>(<span class="params">self</span>):</span><br><span class="line">        nextdata = (self.init &lt;&lt; <span class="number">1</span>) &amp; self.lengthmask</span><br><span class="line">        output = parity(self.init &amp; self.mask)</span><br><span class="line">        nextdata ^= output</span><br><span class="line">        self.init = nextdata</span><br><span class="line">        <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">secret = flag[<span class="number">6</span>:-<span class="number">1</span>]</span><br><span class="line">l = LFSR(<span class="built_in">int</span>(secret[:<span class="number">12</span>], <span class="number">16</span>), <span class="built_in">int</span>(secret[<span class="number">12</span>:], <span class="number">16</span>), <span class="number">48</span>)</span><br><span class="line">outstream = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">96</span>):</span><br><span class="line">    outstream &lt;&lt;= <span class="number">1</span></span><br><span class="line">    outstream |= l.<span class="built_in">next</span>()</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(outstream)[<span class="number">2</span>:])  <span class="comment"># 9375392d53d805407156b455</span></span><br><span class="line"></span><br></pre></td></tr></table></div></figure>
<p>常规的LFSR题目，分析代码可知 $init$ 和 $mask$ 均为 $48bit$ </p>
<p>而结果所给的 $outstream$ 为 $96bit$ ，恰好为两轮加密的长度</p>
<p>①前 $48bit$ 为 $init$ 加密经过一轮加密所得</p>
<p>②后 $ 48bit$ 为前 $48bit$ 再经过一轮加密所得</p>
<p>利用第②点加密前后均已知我们可以求得 $mask$ ，sage代码如下：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">def test(outstream):</span><br><span class="line">    s = [int(x) for x in outstream]</span><br><span class="line"></span><br><span class="line">    M = matrix(GF(2), 48, 48)</span><br><span class="line">    T = vector(GF(2), 48)</span><br><span class="line"></span><br><span class="line">    for i in range(len(s) - 48):</span><br><span class="line">        M[i] = s[i: i + 48]</span><br><span class="line">        T[i] = s[i + 48]</span><br><span class="line">    try:</span><br><span class="line">        mask = M.inverse() * T</span><br><span class="line">        return hex(int(&#x27;&#x27;.join(map(str, (mask))), base=2))</span><br><span class="line">    except:</span><br><span class="line">        return</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">outstream = 0x9375392d53d805407156b455</span><br><span class="line">mask = test(bin(outstream)[2:])</span><br><span class="line">print(&#x27;mask = &#x27; + mask)</span><br></pre></td></tr></table></div></figure>
<p>运行结果：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mask = 0xffbeefc0ff3e</span><br></pre></td></tr></table></div></figure>
<p>解得 $mask$ 后代入第①点即可解出 $init$ ，将 $init$ 和 $mask$ 拼起来即可得到flag，sage代码如下：</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools, hashlib, numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">int2bin</span>(<span class="params">a, n</span>):</span><br><span class="line">    <span class="keyword">assert</span> <span class="number">0</span> &lt;= n <span class="keyword">and</span> a &lt; <span class="number">2</span> ** n</span><br><span class="line">    res = np.zeros(n, dtype=<span class="built_in">int</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        res[n - x - <span class="number">1</span>] = a % <span class="number">2</span></span><br><span class="line">        a = a // <span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> res.tolist()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bin2int</span>(<span class="params">a</span>):</span><br><span class="line">    <span class="keyword">return</span> reduce(<span class="keyword">lambda</span> x, y: x * <span class="number">2</span> + y, a)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bitAnd</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(a) == <span class="built_in">len</span>(b)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x, y: <span class="built_in">int</span>(x) &amp; <span class="built_in">int</span>(y), a, b))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test</span>(<span class="params">outstream</span>):</span><br><span class="line">    s = [<span class="built_in">int</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> outstream]</span><br><span class="line"></span><br><span class="line">    M = matrix(GF(<span class="number">2</span>), <span class="number">48</span>, <span class="number">48</span>)</span><br><span class="line">    T = vector(GF(<span class="number">2</span>), <span class="number">48</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s) - <span class="number">48</span>):</span><br><span class="line">        M[i] = s[i: i + <span class="number">48</span>]</span><br><span class="line">        T[i] = s[i + <span class="number">48</span>]</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        mask = M.inverse() * T</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;mask = &#x27;</span> + <span class="built_in">hex</span>(<span class="built_in">int</span>(<span class="string">&#x27;&#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, (mask))), base=<span class="number">2</span>)))</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    suf = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">48</span>):</span><br><span class="line">        <span class="keyword">if</span> bitAnd([<span class="number">0</span>] + suf + s[<span class="number">0</span>:<span class="number">47</span> - i], mask).count(<span class="number">1</span>) % <span class="number">2</span> == s[<span class="number">47</span> - i]:</span><br><span class="line">            suf = [<span class="number">0</span>] + suf</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            suf = [<span class="number">1</span>] + suf</span><br><span class="line"></span><br><span class="line">    key = <span class="built_in">hex</span>(bin2int(suf))[<span class="number">2</span>:]</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;init = &#x27;</span> + key)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;The flag is Aegis&#123;&#x27;</span> + key + <span class="built_in">hex</span>(<span class="built_in">int</span>(<span class="string">&#x27;&#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, (mask))), base=<span class="number">2</span>)) + <span class="string">&#x27;&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">outstream = <span class="number">0x9375392d53d805407156b455</span></span><br><span class="line">test(<span class="built_in">bin</span>(outstream)[<span class="number">2</span>:])</span><br></pre></td></tr></table></div></figure>
<p>运行结果：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mask = 0xffbeefc0ff3e</span><br><span class="line">init = a11ceb0bff0f</span><br><span class="line">The flag is Aegis&#123;a11ceb0bff0f0xffbeefc0ff3e&#125;</span><br></pre></td></tr></table></div></figure>

        <h2 id="ezECC"   >
          <a href="#ezECC" class="heading-link"><i class="fas fa-link"></i></a><a href="#ezECC" class="headerlink" title="ezECC"></a>ezECC</h2>
      <p>源代码：</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> inverse</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad, unpad</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">Point = namedtuple(<span class="string">&quot;Point&quot;</span>, <span class="string">&quot;x y&quot;</span>)</span><br><span class="line"></span><br><span class="line">O = <span class="string">&#x27;Origin&#x27;</span></span><br><span class="line"></span><br><span class="line">FLAG = <span class="string">b&#x27;Aegis&#123;......&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_point</span>(<span class="params">P: <span class="built_in">tuple</span></span>):</span><br><span class="line">    <span class="keyword">if</span> P == O:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> (P.y**<span class="number">2</span> - (P.x**<span class="number">3</span> + a*P.x + b)) % p == <span class="number">0</span> <span class="keyword">and</span> <span class="number">0</span> &lt;= P.x &lt; p <span class="keyword">and</span> <span class="number">0</span> &lt;= P.y &lt; p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">point_inverse</span>(<span class="params">P: <span class="built_in">tuple</span></span>):</span><br><span class="line">    <span class="keyword">if</span> P == O:</span><br><span class="line">        <span class="keyword">return</span> P</span><br><span class="line">    <span class="keyword">return</span> Point(P.x, -P.y % p)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">point_addition</span>(<span class="params">P: <span class="built_in">tuple</span>, Q: <span class="built_in">tuple</span></span>):</span><br><span class="line">    <span class="keyword">if</span> P == O:</span><br><span class="line">        <span class="keyword">return</span> Q</span><br><span class="line">    <span class="keyword">elif</span> Q == O:</span><br><span class="line">        <span class="keyword">return</span> P</span><br><span class="line">    <span class="keyword">elif</span> Q == point_inverse(P):</span><br><span class="line">        <span class="keyword">return</span> O</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> P == Q:</span><br><span class="line">            lam = (<span class="number">3</span>*P.x**<span class="number">2</span> + a)*inverse(<span class="number">2</span>*P.y, p)</span><br><span class="line">            lam %= p</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            lam = (Q.y - P.y) * inverse((Q.x - P.x), p)</span><br><span class="line">            lam %= p</span><br><span class="line">    Rx = (lam**<span class="number">2</span> - P.x - Q.x) % p</span><br><span class="line">    Ry = (lam*(P.x - Rx) - P.y) % p</span><br><span class="line">    R = Point(Rx, Ry)</span><br><span class="line">    <span class="keyword">assert</span> check_point(R)</span><br><span class="line">    <span class="keyword">return</span> R</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">double_and_add</span>(<span class="params">P: <span class="built_in">tuple</span>, n: <span class="built_in">int</span></span>):</span><br><span class="line">    Q = P</span><br><span class="line">    R = O</span><br><span class="line">    <span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> n % <span class="number">2</span> == <span class="number">1</span>:</span><br><span class="line">            R = point_addition(R, Q)</span><br><span class="line">        Q = point_addition(Q, Q)</span><br><span class="line">        n = n // <span class="number">2</span></span><br><span class="line">    <span class="keyword">assert</span> check_point(R)</span><br><span class="line">    <span class="keyword">return</span> R</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_shared_secret</span>(<span class="params">Q: <span class="built_in">tuple</span>, n: <span class="built_in">int</span></span>):</span><br><span class="line">    S = double_and_add(Q, n)</span><br><span class="line">    <span class="keyword">return</span> S.x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt_flag</span>(<span class="params">shared_secret: <span class="built_in">int</span></span>):</span><br><span class="line">    sha1 = hashlib.sha1()</span><br><span class="line">    sha1.update(<span class="built_in">str</span>(shared_secret).encode(<span class="string">&#x27;ascii&#x27;</span>))</span><br><span class="line">    key = sha1.digest()[:<span class="number">16</span>]</span><br><span class="line">    iv = os.urandom(<span class="number">16</span>)</span><br><span class="line">    cipher = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">    ciphertext = cipher.encrypt(pad(FLAG, <span class="number">16</span>))</span><br><span class="line">    data = &#123;&#125;</span><br><span class="line">    data[<span class="string">&#x27;iv&#x27;</span>] = iv.<span class="built_in">hex</span>()</span><br><span class="line">    data[<span class="string">&#x27;encrypted_flag&#x27;</span>] = ciphertext.<span class="built_in">hex</span>()</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = <span class="number">310717010502520989590157367261876774703</span></span><br><span class="line">a = <span class="number">2</span></span><br><span class="line">b = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">g_x = <span class="number">179210853392303317793440285562762725654</span></span><br><span class="line">g_y = <span class="number">105268671499942631758568591033409611165</span></span><br><span class="line">G = Point(g_x, g_y)</span><br><span class="line"></span><br><span class="line">n = randint(<span class="number">1</span>, p)</span><br><span class="line"></span><br><span class="line">public = double_and_add(G, n)</span><br><span class="line"><span class="built_in">print</span>(public)</span><br><span class="line"></span><br><span class="line">b_x = <span class="number">272640099140026426377756188075937988094</span></span><br><span class="line">b_y = <span class="number">51062462309521034358726608268084433317</span></span><br><span class="line">B = Point(b_x, b_y)</span><br><span class="line"></span><br><span class="line">shared_secret = gen_shared_secret(B, n)</span><br><span class="line"></span><br><span class="line">ciphertext = encrypt_flag(shared_secret)</span><br><span class="line"><span class="built_in">print</span>(ciphertext)</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>
<p>分析代码知道这是一道 ECC 加 AES 的题目，首先解决ECC得到 $shared_secret$ ，然后再代入AES解密即可，下面是具体解决步骤</p>
<p>首先利用Pollig_Hellman算法求出n：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">p = 310717010502520989590157367261876774703</span><br><span class="line">a = 2</span><br><span class="line">b = 3</span><br><span class="line">E = EllipticCurve(GF(p), [a, b])</span><br><span class="line">K = (260053855577519367767956057258891222403, 179596564645843970846404853116641598439)</span><br><span class="line">G = (179210853392303317793440285562762725654, 105268671499942631758568591033409611165)</span><br><span class="line">K = E.point(K)</span><br><span class="line">G = E.point(G)</span><br><span class="line"></span><br><span class="line"># primes中为点G的阶的质因数分解</span><br><span class="line">primes = [2, 3**7, 139, 165229, 31850531, 270778799, 179317983307]</span><br><span class="line">dlogs = []</span><br><span class="line">for fac in primes:</span><br><span class="line">    t = int(G.order()) // int(fac)</span><br><span class="line">    dlog = discrete_log(t*K, t*G, operation=&#x27;+&#x27;)</span><br><span class="line">    dlogs += [dlog]</span><br><span class="line">    print(str(fac) + &#x27;,&#x27; + str(dlog))</span><br><span class="line">n = crt(dlogs, primes)</span><br><span class="line">print(&#x27;n = &#x27; + str(n))</span><br></pre></td></tr></table></div></figure>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">n = 1735615609077661663789047116578013247</span><br></pre></td></tr></table></div></figure>
<p>再利用求出的 $ n $ 计算 $nB$ 得到 $shared_secret$ ：</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">b_x = <span class="number">272640099140026426377756188075937988094</span></span><br><span class="line">b_y = <span class="number">51062462309521034358726608268084433317</span></span><br><span class="line">B = Point(b_x, b_y)</span><br><span class="line">shared_secret = gen_shared_secret(B, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;shared_secret = &quot;</span> + <span class="built_in">str</span>(shared_secret))</span><br></pre></td></tr></table></div></figure>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shared_secret = 80834286993107767130878144281867395240</span><br></pre></td></tr></table></div></figure>
<p>得到 $shared_secret$ 后可以得到AES加密中的key，结合所给的iv，将 $ciphertext$ 解密即可得到 $flag$ ：</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sha1 = hashlib.sha1()</span><br><span class="line">sha1.update(<span class="built_in">str</span>(shared_secret).encode(<span class="string">&#x27;ascii&#x27;</span>))</span><br><span class="line">key = sha1.digest()[:<span class="number">16</span>]</span><br><span class="line"></span><br><span class="line">iv = <span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;45879e81ea63153f4dbc94603cbf6ebc&#x27;</span>)</span><br><span class="line"></span><br><span class="line">cipher = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">plaintext = <span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;db9741d44b9d1718bb9e47b7584795e1f09169119a6d5bafe6fe6a6b950e5669f64ec7057f21711c4e896d4a65de20af&#x27;</span>)</span><br><span class="line">flag = unpad(cipher.decrypt(plaintext), <span class="number">16</span>)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></div></figure>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b&#x27;Aegis&#123;07e2628b590095a5e332d397b8a59aa7&#125;&#x27;</span><br></pre></td></tr></table></div></figure>
<p>完整代码如下：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">from Crypto.Cipher import AES</span><br><span class="line">from Crypto.Util.number import inverse</span><br><span class="line">from Crypto.Util.Padding import pad, unpad</span><br><span class="line">from collections import namedtuple</span><br><span class="line">from random import randint</span><br><span class="line">import hashlib</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line">Point = namedtuple(&quot;Point&quot;, &quot;x y&quot;)</span><br><span class="line"></span><br><span class="line">O = &#x27;Origin&#x27;</span><br><span class="line"></span><br><span class="line">def check_point(P: tuple):</span><br><span class="line">    if P == O:</span><br><span class="line">        return True</span><br><span class="line">    else:</span><br><span class="line">        return (P.y**2 - (P.x**3 + a*P.x + b)) % p == 0 and 0 &lt;= P.x &lt; p and 0 &lt;= P.y &lt; p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def point_inverse(P: tuple):</span><br><span class="line">    if P == O:</span><br><span class="line">        return P</span><br><span class="line">    return Point(P.x, -P.y % p)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def point_addition(P: tuple, Q: tuple):</span><br><span class="line">    if P == O:</span><br><span class="line">        return Q</span><br><span class="line">    elif Q == O:</span><br><span class="line">        return P</span><br><span class="line">    elif Q == point_inverse(P):</span><br><span class="line">        return O</span><br><span class="line">    else:</span><br><span class="line">        if P == Q:</span><br><span class="line">            lam = (3*P.x**2 + a)*inverse(2*P.y, p)</span><br><span class="line">            lam %= p</span><br><span class="line">        else:</span><br><span class="line">            lam = (Q.y - P.y) * inverse((Q.x - P.x), p)</span><br><span class="line">            lam %= p</span><br><span class="line">    Rx = (lam**2 - P.x - Q.x) % p</span><br><span class="line">    Ry = (lam*(P.x - Rx) - P.y) % p</span><br><span class="line">    R = Point(Rx, Ry)</span><br><span class="line">    assert check_point(R)</span><br><span class="line">    return R</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def double_and_add(P: tuple, n: int):</span><br><span class="line">    Q = P</span><br><span class="line">    R = O</span><br><span class="line">    while n &gt; 0:</span><br><span class="line">        if n % 2 == 1:</span><br><span class="line">            R = point_addition(R, Q)</span><br><span class="line">        Q = point_addition(Q, Q)</span><br><span class="line">        n = n // 2</span><br><span class="line">    assert check_point(R)</span><br><span class="line">    return R</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def gen_shared_secret(Q: tuple, n: int):</span><br><span class="line">    S = double_and_add(Q, n)</span><br><span class="line">    return S.x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = 310717010502520989590157367261876774703</span><br><span class="line">a = 2</span><br><span class="line">b = 3</span><br><span class="line">E = EllipticCurve(GF(p), [a, b])</span><br><span class="line">K = (260053855577519367767956057258891222403, 179596564645843970846404853116641598439)</span><br><span class="line">G = (179210853392303317793440285562762725654, 105268671499942631758568591033409611165)</span><br><span class="line">K = E.point(K)</span><br><span class="line">G = E.point(G)</span><br><span class="line"></span><br><span class="line">primes = [2, 3**7, 139, 165229, 31850531, 270778799, 179317983307]</span><br><span class="line">dlogs = []</span><br><span class="line">for fac in primes:</span><br><span class="line">    t = int(G.order()) // int(fac)</span><br><span class="line">    dlog = discrete_log(t*K, t*G, operation=&#x27;+&#x27;)</span><br><span class="line">    dlogs += [dlog]</span><br><span class="line">    print(str(fac) + &#x27;,&#x27; + str(dlog))</span><br><span class="line">n = crt(dlogs, primes)</span><br><span class="line"></span><br><span class="line">b_x = 272640099140026426377756188075937988094</span><br><span class="line">b_y = 51062462309521034358726608268084433317</span><br><span class="line">B = Point(b_x, b_y)</span><br><span class="line">shared_secret = gen_shared_secret(B, n)</span><br><span class="line"></span><br><span class="line">sha1 = hashlib.sha1()</span><br><span class="line">sha1.update(str(shared_secret).encode(&#x27;ascii&#x27;))</span><br><span class="line">key = sha1.digest()[:16]</span><br><span class="line"></span><br><span class="line">iv = bytes.fromhex(&#x27;45879e81ea63153f4dbc94603cbf6ebc&#x27;)</span><br><span class="line"></span><br><span class="line">cipher = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">plaintext = bytes.fromhex(&#x27;db9741d44b9d1718bb9e47b7584795e1f09169119a6d5bafe6fe6a6b950e5669f64ec7057f21711c4e896d4a65de20af&#x27;)</span><br><span class="line">flag = unpad(cipher.decrypt(plaintext), 16)</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></div></figure>
</div><footer class="post-footer"><div class="post-ending ending"><div class="ending__text">------ 本文结束，感谢您的阅读 ------</div></div><div class="post-copyright copyright"><div class="copyright-author"><span class="copyright-author__name">本文作者: </span><span class="copyright-author__value"><a href="https://freeman-cc.github.io">Cc</a></span></div><div class="copyright-link"><span class="copyright-link__name">本文链接: </span><span class="copyright-link__value"><a href="https://freeman-cc.github.io/2022/04/10/Aegis%E6%8B%9B%E6%96%B0%E9%A2%98-crypto-writeup/">https://freeman-cc.github.io/2022/04/10/Aegis%E6%8B%9B%E6%96%B0%E9%A2%98-crypto-writeup/</a></span></div><div class="copyright-notice"><span class="copyright-notice__name">版权声明: </span><span class="copyright-notice__value">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" rel="external nofollow" target="_blank">BY-NC-SA</a> 许可协议。转载请注明出处！</span></div></div><div class="post-tags"><span class="post-tags-item"><span class="post-tags-item__icon"><i class="fas fa-tag"></i></span><a class="post-tags-item__link" href="https://freeman-cc.github.io/tags/Crypto/">Crypto</a></span></div><nav class="post-paginator paginator"><div class="paginator-prev"><a class="paginator-prev__link" href="/2022/04/10/CNSS%E6%8B%9B%E6%96%B0%E9%A2%98-2021-crypto-writeup/"><span class="paginator-prev__icon"><i class="fas fa-angle-left"></i></span><span class="paginator-prev__text">CNSS招新题-2021-crypto-writeup</span></a></div><div class="paginator-next"><a class="paginator-next__link" href="/2022/04/09/NTRU%E7%AE%97%E6%B3%95%E8%AF%A6%E8%A7%A3/"><span class="paginator-prev__text">NTRU算法详解</span><span class="paginator-next__icon"><i class="fas fa-angle-right"></i></span></a></div></nav></footer></div></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><div class="sidebar-nav"><span class="sidebar-nav-toc current">文章目录</span><span class="sidebar-nav-ov">站点概览</span></div><section class="sidebar-toc"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Aegis%E6%8B%9B%E6%96%B0%E9%A2%98-crypto-writeup"><span class="toc-number">1.</span> <span class="toc-text">
          Aegis招新题-crypto-writeup</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Kinoko%E7%9A%84%E4%BB%A3%E7%A0%81-I"><span class="toc-number">1.1.</span> <span class="toc-text">
          Kinoko的代码 I</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Kinoko%E7%9A%84%E4%BB%A3%E7%A0%81-II"><span class="toc-number">1.2.</span> <span class="toc-text">
          Kinoko的代码 II</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Kinoko%E7%9A%84%E4%BB%A3%E7%A0%81-III"><span class="toc-number">1.3.</span> <span class="toc-text">
          Kinoko的代码 III</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Kinoko%E7%9A%84%E4%BB%A3%E7%A0%81-IV"><span class="toc-number">1.4.</span> <span class="toc-text">
          Kinoko的代码 IV</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#notRSA"><span class="toc-number">1.5.</span> <span class="toc-text">
          notRSA</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#LFSR"><span class="toc-number">1.6.</span> <span class="toc-text">
          LFSR</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ezECC"><span class="toc-number">1.7.</span> <span class="toc-text">
          ezECC</span></a></li></ol></li></ol></section><!-- ov = overview--><section class="sidebar-ov hide"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="/images/icons/stun-logo.svg" alt="avatar"></div><p class="sidebar-ov-author__text">hello world</p></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">4</div><div class="sidebar-ov-state-item__name">归档</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--tags" href="/tags/"><div class="sidebar-ov-state-item__count">1</div><div class="sidebar-ov-state-item__name">标签</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="知识共享许可协议" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section><div class="sidebar-reading"><div class="sidebar-reading-info"><span class="sidebar-reading-info__text">你已阅读了 </span><span class="sidebar-reading-info__num">0</span><span class="sidebar-reading-info__perc">%</span></div><div class="sidebar-reading-line"></div></div></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright © 2022</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>Cc</span></div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script type="text/x-mathjax-config">var mathjaxMhchem = '';
var mathJaxTex = {
  equationNumbers: {
    autoNumber: 'AMS'
  }
};

if (false) {
  mathjaxMhchem = 'https://cdn.jsdelivr.net/npm/mathjax-mhchem@3.3.2/mhchem.min.js';
  MathJax.Ajax.config.path['mhchem'] = mathjaxMhchem;

  mathJaxTex.extensions = [mathjaxMhchem];
} else {
  mathJaxTex.extensions = ['AMSmath.js','AMSsymbols.js'];
}

MathJax.Hub.Config({
  menuSettings: {
    zoom: 'None'
  },
  showMathMenu: false,
  jax: ['input/TeX','output/CommonHTML'],
  extensions: ['tex2jax.js'],
  TeX: mathJaxTex,
  tex2jax: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['\\[', '\\]']],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  }
});

MathJax.Hub.Register.StartupHook('TeX Jax Ready', function() {
  MathJax.InputJax.TeX.prefilterHooks.Add(function(data) {
    if (data.display) {
      var next = data.script.nextSibling;
      while (next && next.nodeName.toLowerCase() === '#text') { next = next.nextSibling; }
      if (next && next.nodeName.toLowerCase() === 'br') { next.parentNode.removeChild(next); }
    }
  });
});

MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i = 0; i < all.length; i++) {
    document.getElementById(all[i].inputID + '-Frame').parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.jsdelivr.net/npm/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script src="/js/utils.js?v=2.6.2"></script><script src="/js/stun-boot.js?v=2.6.2"></script><script src="/js/scroll.js?v=2.6.2"></script><script src="/js/header.js?v=2.6.2"></script><script src="/js/sidebar.js?v=2.6.2"></script></body></html>