<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/images/icons/favicon-16x16.png?v=2.6.2" type="image/png" sizes="16x16"><link rel="icon" href="/images/icons/favicon-32x32.png?v=2.6.2" type="image/png" sizes="32x32"><meta name="description" content="CNSS招新题-crypto-writeup        Ccc                      [😋] 大大超人的代码 I       先贴代码 123456789from Crypto.Util.number import long_to_bytesa &#x3D; 104999589990378770458608191456545921395312">
<meta property="og:type" content="article">
<meta property="og:title" content="CNSS招新题-2021-crypto-writeup">
<meta property="og:url" content="https://freeman-cc.github.io/2022/04/10/CNSS%E6%8B%9B%E6%96%B0%E9%A2%98-2021-crypto-writeup/index.html">
<meta property="og:site_name" content="Cc&#39;s Blog">
<meta property="og:description" content="CNSS招新题-crypto-writeup        Ccc                      [😋] 大大超人的代码 I       先贴代码 123456789from Crypto.Util.number import long_to_bytesa &#x3D; 104999589990378770458608191456545921395312">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-04-10T06:04:41.000Z">
<meta property="article:modified_time" content="2022-04-10T06:07:37.432Z">
<meta property="article:author" content="Cc">
<meta property="article:tag" content="Crypto">
<meta name="twitter:card" content="summary"><title>CNSS招新题-2021-crypto-writeup | Cc's Blog</title><link ref="canonical" href="https://freeman-cc.github.io/2022/04/10/CNSS%E6%8B%9B%E6%96%B0%E9%A2%98-2021-crypto-writeup/"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.6.2"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  assistSearch: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":true,"scrollDownIcon":false},
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"default","highlight":"light","wordWrap":false},
  reward: false,
  fancybox: false,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: undefined,
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"复制","copySuccess":"复制成功","copyError":"复制失败"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="Cc's Blog" type="application/atom+xml">
</head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">首页</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">归档</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/tags/"><span class="header-nav-menu-item__icon"><i class="fas fa-tags"></i></span><span class="header-nav-menu-item__text">标签</span></a></div></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">Cc's Blog</div><div class="header-banner-info__subtitle">Welcome to my blog, have a nice day!</div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content" id="content"><!-- Just used to judge whether it is an article page--><div id="is-post"></div><div class="post"><header class="post-header"><h1 class="post-title">CNSS招新题-2021-crypto-writeup</h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2022-04-10</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新于</span><span class="post-meta-item__value">2022-04-10</span></span></div></header><div class="post-body">
        <h1 id="CNSS招新题-crypto-writeup"   >
          <a href="#CNSS招新题-crypto-writeup" class="heading-link"><i class="fas fa-link"></i></a><a href="#CNSS招新题-crypto-writeup" class="headerlink" title="CNSS招新题-crypto-writeup"></a>CNSS招新题-crypto-writeup</h1>
      <blockquote>
<p>Ccc</p>
</blockquote>

        <h3 id="😋-大大超人的代码-I"   >
          <a href="#😋-大大超人的代码-I" class="heading-link"><i class="fas fa-link"></i></a><a href="#😋-大大超人的代码-I" class="headerlink" title="[😋] 大大超人的代码 I"></a>[😋] 大大超人的代码 I</h3>
      <p>先贴代码</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line">a = <span class="number">10499958999037877045860819145654592139531258013786800315952660437695953206118177802362538707257147839843929607571065996701775308516344320494492623326535070933404552245238889019529867495706219558537483959855018656456767601472852530792072968424254995263689863458109858200434368660199825370006622972172615283000225895986795432100524830372657448639751748649746517567275491877758341825114165092719349624453145256163927226959292249202574111889453838454722039</span></span><br><span class="line">n = <span class="number">24482146465492008075985247474612414320648047425785643838292024343856484727961531014143038475016832753633643464040872815615028679515938203288641456487330618969964445990607887042678786725649115551121279019558561466028015891949399125083811735238746137986294864917479675168130071009961552443914582290960081092498541343026165888900247802180370535720495152921978143267961988522304615862013752399728187062523671938698800778472385717512452760615330027345844283</span></span><br><span class="line">b = <span class="number">13974352443151</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">	<span class="keyword">if</span>(a*i%n==b):</span><br><span class="line">		<span class="keyword">break</span></span><br><span class="line">flag = <span class="string">b&#x27;cnss&#123;&#x27;</span>+long_to_bytes(i)+<span class="string">&#x27;&#125;&#x27;</span></span><br></pre></td></tr></table></div></figure>
<p>求逆，利用扩展欧几里得算法求解即可</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ext_gcd</span>(<span class="params">a, b</span>):  <span class="comment"># 扩展欧几里得算法</span></span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>, <span class="number">0</span>, a</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        x, y, gcd = ext_gcd(b, a % b)  <span class="comment"># 递归直至余数等于0(需多递归一层用来判断)</span></span><br><span class="line">        x, y = y, (x - (a // b) * y)  <span class="comment"># 辗转相除法反向推导每层a、b的因子使得gcd(a,b)=ax+by成立</span></span><br><span class="line">        <span class="keyword">return</span> x, y, gcd</span><br><span class="line"></span><br><span class="line">a = <span class="number">10499958999037877045860819145654592139531258013786800315952660437695953206118177802362538707257147839843929607571065996701775308516344320494492623326535070933404552245238889019529867495706219558537483959855018656456767601472852530792072968424254995263689863458109858200434368660199825370006622972172615283000225895986795432100524830372657448639751748649746517567275491877758341825114165092719349624453145256163927226959292249202574111889453838454722039</span></span><br><span class="line">n = <span class="number">24482146465492008075985247474612414320648047425785643838292024343856484727961531014143038475016832753633643464040872815615028679515938203288641456487330618969964445990607887042678786725649115551121279019558561466028015891949399125083811735238746137986294864917479675168130071009961552443914582290960081092498541343026165888900247802180370535720495152921978143267961988522304615862013752399728187062523671938698800778472385717512452760615330027345844283</span></span><br><span class="line">b = <span class="number">13974352443151</span></span><br><span class="line"></span><br><span class="line">d = ext_gcd(a, n)[<span class="number">0</span>]</span><br><span class="line">i = b*d % n</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;cnss&#123;&quot;</span> + long_to_bytes(i).decode() + <span class="string">&quot;&#125;&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>
<p>得到flag</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnss&#123;you yi ge ren qian lai mai gua. lue lue lue lue lue. sa ri lang, sa ri lang. ei, hua qiang, hua qiang&#125;</span><br></pre></td></tr></table></div></figure>

        <h3 id="😋-大大超人的代码-II"   >
          <a href="#😋-大大超人的代码-II" class="heading-link"><i class="fas fa-link"></i></a><a href="#😋-大大超人的代码-II" class="headerlink" title="[😋] 大大超人的代码 II"></a>[😋] 大大超人的代码 II</h3>
      <p>先贴代码</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> gcd</span><br><span class="line"></span><br><span class="line">num = <span class="number">42884020547169390364057708512857160494285905714049130207174574321294001570717794624065180823944268300615872241601579039570417514768021539120794827687319577302185669966605784385135475359835440522138098740956869698753641542827169807498060060203204623056652296548672193678604201527271552258183411014527366217548194668469156210293296924920396661175084847772705813725399053734267798263155285086152337660486536186646844672457165552673635686438518233777750910982014487846162409685706645584022613739678475494110418588076015804320630926293482802728176941310074063709832881421592093809601385355979927053037564815022569532301725889642648753691270079271760325794402609541247330395378653665694056501747438163292250560881807911461231726101015329450977148586716650828721964825603783645451441758913032780302842678209454303821607654073090650401139540242325808963472494771631432989047762098809264580664019379523293624441137658106554812934798531301113822034790852090529061101693937747989599304386879458074169786212163676139153571980665024887827190167719665028793495590181448050849517686984259984456749798664352548534304800162670309538117876068852938462001997080070145586746296815514664296506732662997084432462415745714170644890474456380187175650685331337577272850596655499330349676234958852437039128355237654047269</span></span><br><span class="line">cnt = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,num):</span><br><span class="line">	<span class="keyword">if</span> gcd(i,num) == <span class="number">1</span>:</span><br><span class="line">		cnt += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">flag = md5(<span class="built_in">str</span>(cnt).encode()).hexdigest()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Flag is cnss&#123;&#x27;</span> + flag <span class="string">&#x27;&#125;&#x27;</span>)</span><br></pre></td></tr></table></div></figure>
<p>求 $1$ 到 $num-1$ 中与 $num$ 互素的元素的和，也就是求 $num$ 的欧拉函数值，将 $num$ 质因数分解后利用公式求解即可</p>
<p>对 $num$ 进行质因数时 $factordb$ 不管用了，利用一下代码分解</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">start = time.perf_counter()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 判断输入是否为素数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">prime</span>(<span class="params">n</span>):</span><br><span class="line">    <span class="keyword">if</span> n <span class="keyword">in</span> &#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>&#125;:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">if</span> n % <span class="number">2</span> == <span class="number">0</span> <span class="keyword">or</span> n % <span class="number">3</span> == <span class="number">0</span> <span class="keyword">or</span> n % <span class="number">5</span> == <span class="number">0</span> <span class="keyword">or</span> n % <span class="number">7</span> == <span class="number">0</span> <span class="keyword">or</span> n % <span class="number">11</span> == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    t = <span class="number">0</span></span><br><span class="line">    u = n - <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> u % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">        t += <span class="number">1</span></span><br><span class="line">        u //= <span class="number">2</span></span><br><span class="line">    a = random.randint(<span class="number">2</span>, n - <span class="number">1</span>)</span><br><span class="line">    r = <span class="built_in">pow</span>(a, u, n)</span><br><span class="line">    <span class="keyword">if</span> r != <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">while</span> t &gt; <span class="number">1</span> <span class="keyword">and</span> r != n - <span class="number">1</span>:</span><br><span class="line">            r = (r * r) % n</span><br><span class="line">            t -= <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> r != n - <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 寻找输入的一个因数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find</span>(<span class="params">n, a</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">x</span>):</span><br><span class="line">        <span class="keyword">return</span> (x * x + a) % n</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 补上因子为2的判定</span></span><br><span class="line">    <span class="keyword">if</span> n % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    x1 = random.randint(<span class="number">0</span>, n)</span><br><span class="line">    x2 = x1</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        x1 = f(x1)</span><br><span class="line">        x2 = f(f(x2))</span><br><span class="line">        p = math.gcd(<span class="built_in">abs</span>(x2 - x1), n)</span><br><span class="line">        <span class="keyword">if</span> p &gt; <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> p</span><br><span class="line">        <span class="keyword">if</span> x1 == x2:</span><br><span class="line">            <span class="keyword">return</span> n</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">factor_n</span>(<span class="params">num</span>):</span><br><span class="line">    prime_list = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> num != <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">if</span> prime(num):</span><br><span class="line">            prime_list.append(num)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            c = find(num, random.randint(<span class="number">0</span>, num - <span class="number">1</span>))</span><br><span class="line">            <span class="keyword">if</span> prime(c):</span><br><span class="line">                prime_list.append(c)</span><br><span class="line">                num //= c</span><br><span class="line">    prime_list.sort()</span><br><span class="line">    <span class="keyword">return</span> prime_list</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    num = <span class="number">42884020547169390364057708512857160494285905714049130207174574321294001570717794624065180823944268300615872241601579039570417514768021539120794827687319577302185669966605784385135475359835440522138098740956869698753641542827169807498060060203204623056652296548672193678604201527271552258183411014527366217548194668469156210293296924920396661175084847772705813725399053734267798263155285086152337660486536186646844672457165552673635686438518233777750910982014487846162409685706645584022613739678475494110418588076015804320630926293482802728176941310074063709832881421592093809601385355979927053037564815022569532301725889642648753691270079271760325794402609541247330395378653665694056501747438163292250560881807911461231726101015329450977148586716650828721964825603783645451441758913032780302842678209454303821607654073090650401139540242325808963472494771631432989047762098809264580664019379523293624441137658106554812934798531301113822034790852090529061101693937747989599304386879458074169786212163676139153571980665024887827190167719665028793495590181448050849517686984259984456749798664352548534304800162670309538117876068852938462001997080070145586746296815514664296506732662997084432462415745714170644890474456380187175650685331337577272850596655499330349676234958852437039128355237654047269</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;num&#125;</span>=&#x27;</span>)</span><br><span class="line">    prime_list = factor_n(num)</span><br><span class="line">    <span class="built_in">print</span>(prime_list)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;*&#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, prime_list)))</span><br><span class="line"></span><br><span class="line">    end = time.process_time()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;Running time: <span class="subst">&#123;end - start&#125;</span> Seconds&#x27;</span>)</span><br><span class="line">    </span><br></pre></td></tr></table></div></figure>
<p>得到分解结果如下</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">726469</span>, <span class="number">726469</span>, <span class="number">726469</span>, <span class="number">726469</span>, <span class="number">726469</span>, <span class="number">1248059</span>, <span class="number">1248059</span>, <span class="number">1248059</span>, <span class="number">1248059</span>, <span class="number">1248059</span>, <span class="number">1248059</span>, <span class="number">3488777</span>, <span class="number">3488777</span>, <span class="number">3488777</span>, <span class="number">3488777</span>, <span class="number">3488777</span>, <span class="number">3488777</span>, <span class="number">4003333</span>, <span class="number">4003333</span>, <span class="number">4003333</span>, <span class="number">4003333</span>, <span class="number">4003333</span>, <span class="number">4003333</span>, <span class="number">4003333</span>, <span class="number">7324349</span>, <span class="number">7324349</span>, <span class="number">7324349</span>, <span class="number">7324349</span>, <span class="number">7324349</span>, <span class="number">7324349</span>, <span class="number">7324349</span>, <span class="number">7324349</span>, <span class="number">7324349</span>, <span class="number">13943177</span>, <span class="number">13943177</span>, <span class="number">13943177</span>, <span class="number">13943177</span>, <span class="number">13943177</span>, <span class="number">13943177</span>, <span class="number">14429917</span>, <span class="number">14429917</span>, <span class="number">14429917</span>, <span class="number">14429917</span>, <span class="number">14429917</span>, <span class="number">14429917</span>, <span class="number">14429917</span>, <span class="number">14429917</span>, <span class="number">14429917</span>, <span class="number">14429917</span>, <span class="number">40264613</span>, <span class="number">40264613</span>, <span class="number">40264613</span>, <span class="number">40264613</span>, <span class="number">40264613</span>, <span class="number">40264613</span>, <span class="number">40264613</span>, <span class="number">40264613</span>, <span class="number">40264613</span>, <span class="number">40264613</span>, <span class="number">117077309</span>, <span class="number">117077309</span>, <span class="number">117077309</span>, <span class="number">117077309</span>, <span class="number">117077309</span>, <span class="number">416211353</span>, <span class="number">416211353</span>, <span class="number">416211353</span>, <span class="number">416211353</span>, <span class="number">416211353</span>, <span class="number">416211353</span>, <span class="number">416211353</span>, <span class="number">416211353</span>, <span class="number">416211353</span>, <span class="number">925020799</span>, <span class="number">925020799</span>, <span class="number">925020799</span>, <span class="number">925020799</span>, <span class="number">925020799</span>, <span class="number">925020799</span>, <span class="number">925020799</span>, <span class="number">925020799</span>, <span class="number">925020799</span>, <span class="number">1291513693</span>, <span class="number">1291513693</span>, <span class="number">1291513693</span>, <span class="number">1291513693</span>, <span class="number">1291513693</span>, <span class="number">1291513693</span>, <span class="number">1291513693</span>, <span class="number">1291513693</span>, <span class="number">1291513693</span>, <span class="number">1291513693</span>, <span class="number">4297172359</span>, <span class="number">4297172359</span>, <span class="number">4297172359</span>, <span class="number">4297172359</span>, <span class="number">4297172359</span>, <span class="number">4297172359</span>, <span class="number">4297172359</span>, <span class="number">6945055903</span>, <span class="number">6945055903</span>, <span class="number">6945055903</span>, <span class="number">6945055903</span>, <span class="number">6945055903</span>, <span class="number">6945055903</span>, <span class="number">6945055903</span>, <span class="number">6945055903</span>, <span class="number">14980192757</span>, <span class="number">14980192757</span>, <span class="number">14980192757</span>, <span class="number">14980192757</span>, <span class="number">14980192757</span>, <span class="number">14980192757</span>, <span class="number">31896490931</span>, <span class="number">31896490931</span>, <span class="number">31896490931</span>, <span class="number">31896490931</span>, <span class="number">31896490931</span>, <span class="number">31896490931</span>, <span class="number">31896490931</span>, <span class="number">31896490931</span>, <span class="number">34448261957</span>, <span class="number">34448261957</span>, <span class="number">34448261957</span>, <span class="number">34448261957</span>, <span class="number">34448261957</span>, <span class="number">34448261957</span>, <span class="number">34448261957</span>, <span class="number">34448261957</span>, <span class="number">34448261957</span>, <span class="number">42273263297</span>, <span class="number">42273263297</span>, <span class="number">42273263297</span>, <span class="number">42273263297</span>, <span class="number">42273263297</span>, <span class="number">334972370143</span>, <span class="number">334972370143</span>, <span class="number">334972370143</span>, <span class="number">334972370143</span>, <span class="number">334972370143</span>, <span class="number">334972370143</span>, <span class="number">409576292549</span>, <span class="number">409576292549</span>, <span class="number">409576292549</span>, <span class="number">409576292549</span>, <span class="number">409576292549</span>, <span class="number">409576292549</span>, <span class="number">409576292549</span>, <span class="number">409576292549</span>]</span><br></pre></td></tr></table></div></figure>
<p>接下来利用欧拉函数求解即可</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line"><span class="built_in">list</span> = [<span class="string">&#x27;726469&#x27;</span>, <span class="string">&#x27;726469&#x27;</span>, <span class="string">&#x27;726469&#x27;</span>, <span class="string">&#x27;726469&#x27;</span>, <span class="string">&#x27;726469&#x27;</span>, <span class="string">&#x27;1248059&#x27;</span>, <span class="string">&#x27;1248059&#x27;</span>, <span class="string">&#x27;1248059&#x27;</span>, <span class="string">&#x27;1248059&#x27;</span>, <span class="string">&#x27;1248059&#x27;</span>, <span class="string">&#x27;1248059&#x27;</span>, <span class="string">&#x27;3488777&#x27;</span>, <span class="string">&#x27;3488777&#x27;</span>, <span class="string">&#x27;3488777&#x27;</span>, <span class="string">&#x27;3488777&#x27;</span>, <span class="string">&#x27;3488777&#x27;</span>, <span class="string">&#x27;3488777&#x27;</span>, <span class="string">&#x27;4003333&#x27;</span>, <span class="string">&#x27;4003333&#x27;</span>, <span class="string">&#x27;4003333&#x27;</span>, <span class="string">&#x27;4003333&#x27;</span>, <span class="string">&#x27;4003333&#x27;</span>, <span class="string">&#x27;4003333&#x27;</span>, <span class="string">&#x27;4003333&#x27;</span>, <span class="string">&#x27;7324349&#x27;</span>, <span class="string">&#x27;7324349&#x27;</span>, <span class="string">&#x27;7324349&#x27;</span>, <span class="string">&#x27;7324349&#x27;</span>, <span class="string">&#x27;7324349&#x27;</span>, <span class="string">&#x27;7324349&#x27;</span>, <span class="string">&#x27;7324349&#x27;</span>, <span class="string">&#x27;7324349&#x27;</span>, <span class="string">&#x27;7324349&#x27;</span>, <span class="string">&#x27;13943177&#x27;</span>, <span class="string">&#x27;13943177&#x27;</span>, <span class="string">&#x27;13943177&#x27;</span>, <span class="string">&#x27;13943177&#x27;</span>, <span class="string">&#x27;13943177&#x27;</span>, <span class="string">&#x27;13943177&#x27;</span>, <span class="string">&#x27;14429917&#x27;</span>, <span class="string">&#x27;14429917&#x27;</span>, <span class="string">&#x27;14429917&#x27;</span>, <span class="string">&#x27;14429917&#x27;</span>, <span class="string">&#x27;14429917&#x27;</span>, <span class="string">&#x27;14429917&#x27;</span>, <span class="string">&#x27;14429917&#x27;</span>, <span class="string">&#x27;14429917&#x27;</span>, <span class="string">&#x27;14429917&#x27;</span>, <span class="string">&#x27;14429917&#x27;</span>, <span class="string">&#x27;40264613&#x27;</span>, <span class="string">&#x27;40264613&#x27;</span>, <span class="string">&#x27;40264613&#x27;</span>, <span class="string">&#x27;40264613&#x27;</span>, <span class="string">&#x27;40264613&#x27;</span>, <span class="string">&#x27;40264613&#x27;</span>, <span class="string">&#x27;40264613&#x27;</span>, <span class="string">&#x27;40264613&#x27;</span>, <span class="string">&#x27;40264613&#x27;</span>, <span class="string">&#x27;40264613&#x27;</span>, <span class="string">&#x27;117077309&#x27;</span>, <span class="string">&#x27;117077309&#x27;</span>, <span class="string">&#x27;117077309&#x27;</span>, <span class="string">&#x27;117077309&#x27;</span>, <span class="string">&#x27;117077309&#x27;</span>, <span class="string">&#x27;416211353&#x27;</span>, <span class="string">&#x27;416211353&#x27;</span>, <span class="string">&#x27;416211353&#x27;</span>, <span class="string">&#x27;416211353&#x27;</span>, <span class="string">&#x27;416211353&#x27;</span>, <span class="string">&#x27;416211353&#x27;</span>, <span class="string">&#x27;416211353&#x27;</span>, <span class="string">&#x27;416211353&#x27;</span>, <span class="string">&#x27;416211353&#x27;</span>, <span class="string">&#x27;925020799&#x27;</span>, <span class="string">&#x27;925020799&#x27;</span>, <span class="string">&#x27;925020799&#x27;</span>, <span class="string">&#x27;925020799&#x27;</span>, <span class="string">&#x27;925020799&#x27;</span>, <span class="string">&#x27;925020799&#x27;</span>, <span class="string">&#x27;925020799&#x27;</span>, <span class="string">&#x27;925020799&#x27;</span>, <span class="string">&#x27;925020799&#x27;</span>, <span class="string">&#x27;1291513693&#x27;</span>, <span class="string">&#x27;1291513693&#x27;</span>, <span class="string">&#x27;1291513693&#x27;</span>, <span class="string">&#x27;1291513693&#x27;</span>, <span class="string">&#x27;1291513693&#x27;</span>, <span class="string">&#x27;1291513693&#x27;</span>, <span class="string">&#x27;1291513693&#x27;</span>, <span class="string">&#x27;1291513693&#x27;</span>, <span class="string">&#x27;1291513693&#x27;</span>, <span class="string">&#x27;1291513693&#x27;</span>, <span class="string">&#x27;4297172359&#x27;</span>, <span class="string">&#x27;4297172359&#x27;</span>, <span class="string">&#x27;4297172359&#x27;</span>, <span class="string">&#x27;4297172359&#x27;</span>, <span class="string">&#x27;4297172359&#x27;</span>, <span class="string">&#x27;4297172359&#x27;</span>, <span class="string">&#x27;4297172359&#x27;</span>, <span class="string">&#x27;6945055903&#x27;</span>, <span class="string">&#x27;6945055903&#x27;</span>, <span class="string">&#x27;6945055903&#x27;</span>, <span class="string">&#x27;6945055903&#x27;</span>, <span class="string">&#x27;6945055903&#x27;</span>, <span class="string">&#x27;6945055903&#x27;</span>, <span class="string">&#x27;6945055903&#x27;</span>, <span class="string">&#x27;6945055903&#x27;</span>, <span class="string">&#x27;14980192757&#x27;</span>, <span class="string">&#x27;14980192757&#x27;</span>, <span class="string">&#x27;14980192757&#x27;</span>, <span class="string">&#x27;14980192757&#x27;</span>, <span class="string">&#x27;14980192757&#x27;</span>, <span class="string">&#x27;14980192757&#x27;</span>, <span class="string">&#x27;31896490931&#x27;</span>, <span class="string">&#x27;31896490931&#x27;</span>, <span class="string">&#x27;31896490931&#x27;</span>, <span class="string">&#x27;31896490931&#x27;</span>, <span class="string">&#x27;31896490931&#x27;</span>, <span class="string">&#x27;31896490931&#x27;</span>, <span class="string">&#x27;31896490931&#x27;</span>, <span class="string">&#x27;31896490931&#x27;</span>, <span class="string">&#x27;34448261957&#x27;</span>, <span class="string">&#x27;34448261957&#x27;</span>, <span class="string">&#x27;34448261957&#x27;</span>, <span class="string">&#x27;34448261957&#x27;</span>, <span class="string">&#x27;34448261957&#x27;</span>, <span class="string">&#x27;34448261957&#x27;</span>, <span class="string">&#x27;34448261957&#x27;</span>, <span class="string">&#x27;34448261957&#x27;</span>, <span class="string">&#x27;34448261957&#x27;</span>, <span class="string">&#x27;42273263297&#x27;</span>, <span class="string">&#x27;42273263297&#x27;</span>, <span class="string">&#x27;42273263297&#x27;</span>, <span class="string">&#x27;42273263297&#x27;</span>, <span class="string">&#x27;42273263297&#x27;</span>, <span class="string">&#x27;334972370143&#x27;</span>, <span class="string">&#x27;334972370143&#x27;</span>, <span class="string">&#x27;334972370143&#x27;</span>, <span class="string">&#x27;334972370143&#x27;</span>, <span class="string">&#x27;334972370143&#x27;</span>, <span class="string">&#x27;334972370143&#x27;</span>, <span class="string">&#x27;409576292549&#x27;</span>, <span class="string">&#x27;409576292549&#x27;</span>, <span class="string">&#x27;409576292549&#x27;</span>, <span class="string">&#x27;409576292549&#x27;</span>, <span class="string">&#x27;409576292549&#x27;</span>, <span class="string">&#x27;409576292549&#x27;</span>, <span class="string">&#x27;409576292549&#x27;</span>, <span class="string">&#x27;409576292549&#x27;</span>]</span><br><span class="line">s = <span class="number">1</span></span><br><span class="line">n = <span class="number">42884020547169390364057708512857160494285905714049130207174574321294001570717794624065180823944268300615872241601579039570417514768021539120794827687319577302185669966605784385135475359835440522138098740956869698753641542827169807498060060203204623056652296548672193678604201527271552258183411014527366217548194668469156210293296924920396661175084847772705813725399053734267798263155285086152337660486536186646844672457165552673635686438518233777750910982014487846162409685706645584022613739678475494110418588076015804320630926293482802728176941310074063709832881421592093809601385355979927053037564815022569532301725889642648753691270079271760325794402609541247330395378653665694056501747438163292250560881807911461231726101015329450977148586716650828721964825603783645451441758913032780302842678209454303821607654073090650401139540242325808963472494771631432989047762098809264580664019379523293624441137658106554812934798531301113822034790852090529061101693937747989599304386879458074169786212163676139153571980665024887827190167719665028793495590181448050849517686984259984456749798664352548534304800162670309538117876068852938462001997080070145586746296815514664296506732662997084432462415745714170644890474456380187175650685331337577272850596655499330349676234958852437039128355237654047269</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">list</span>:</span><br><span class="line">    s *= <span class="built_in">int</span>(i)</span><br><span class="line"></span><br><span class="line">nb = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">list</span>:</span><br><span class="line">    <span class="keyword">if</span> i <span class="keyword">not</span> <span class="keyword">in</span> nb:</span><br><span class="line">        nb.append(i)</span><br><span class="line"><span class="built_in">print</span>(nb)</span><br><span class="line"></span><br><span class="line">phi = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> nb:</span><br><span class="line">    phi *= n - n//<span class="built_in">int</span>(i)</span><br><span class="line"></span><br><span class="line">phi = phi//(n**(<span class="built_in">len</span>(nb)-<span class="number">1</span>))</span><br><span class="line">flag = <span class="string">&quot;cnss&#123;&quot;</span> + md5(<span class="built_in">str</span>(phi).encode()).hexdigest() + <span class="string">&quot;&#125;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(phi)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="built_in">print</span>(s == n)</span><br></pre></td></tr></table></div></figure>
<p>得到flag</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnss&#123;7b4a23cf05fc166e2f5e6798d737cb83&#125;</span><br></pre></td></tr></table></div></figure>

        <h3 id="😋-EZRSA"   >
          <a href="#😋-EZRSA" class="heading-link"><i class="fas fa-link"></i></a><a href="#😋-EZRSA" class="headerlink" title="[😋] EZRSA"></a>[😋] EZRSA</h3>
      <p>代码</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long,getPrime</span><br><span class="line"></span><br><span class="line">flag = <span class="string">u&#x27;xxxxxx&#x27;</span></span><br><span class="line">m = bytes_to_long(flag.encode())</span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line">e = <span class="number">3</span></span><br><span class="line">n = p*q</span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"></span><br><span class="line"><span class="comment">#17122915166265113628936084259612311876364779252333817653908064563012403283413723801149226058776045562431863561527598029708484050735340376592692944196636066937254842628374596659520832392883941088961925998112268354069528298108259950738233300271339429579172788606259082714089126140552788081701431773946954101521880287079138683872063436125499187482930254182605546821908768554127091588674102227605591868183216588952297634056187432224500652151699978753316630287127751214117068167697654397115835061787620207935678045116272234790320727737354518224845334305441037073149880267837099939565780539222758100209016162314144630920799</span></span><br><span class="line"><span class="comment">#16926458617386458077637050106018850896006879092288192701331681605474802210713231004923465605065133301881405183688853792875133217926741592214428875953305593414362683885848278980412814134018268287018200015497631362139676275057736654215717198437649465165438442373537289011460247398965575656801213891887710880496787600356785377725103473390014610976378061619695088235473509</span></span><br></pre></td></tr></table></div></figure>
<p>注意到加密指数 $e=3$ ，直接尝试对 $c+kn$ 开立方，尝试发现 $ k=0 $ 时就可以得到flag</p>
<p>解密代码如下</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">c = <span class="number">16926458617386458077637050106018850896006879092288192701331681605474802210713231004923465605065133301881405183688853792875133217926741592214428875953305593414362683885848278980412814134018268287018200015497631362139676275057736654215717198437649465165438442373537289011460247398965575656801213891887710880496787600356785377725103473390014610976378061619695088235473509</span></span><br><span class="line">n = <span class="number">17122915166265113628936084259612311876364779252333817653908064563012403283413723801149226058776045562431863561527598029708484050735340376592692944196636066937254842628374596659520832392883941088961925998112268354069528298108259950738233300271339429579172788606259082714089126140552788081701431773946954101521880287079138683872063436125499187482930254182605546821908768554127091588674102227605591868183216588952297634056187432224500652151699978753316630287127751214117068167697654397115835061787620207935678045116272234790320727737354518224845334305441037073149880267837099939565780539222758100209016162314144630920799</span></span><br><span class="line"></span><br><span class="line">status = gmpy2.iroot(c, <span class="number">3</span>)[<span class="number">1</span>] <span class="comment">#status为1表示改数能被开立方成整数</span></span><br><span class="line">rootnumber = gmpy2.iroot(c, <span class="number">3</span>)[<span class="number">0</span>] <span class="comment">#开立方后的结果</span></span><br><span class="line"><span class="built_in">print</span>(rootnumber)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(rootnumber).decode())</span><br></pre></td></tr></table></div></figure>
<p>得到flag：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnss&#123;面对恐惧的最好办法就是消除恐惧&#125;</span><br></pre></td></tr></table></div></figure>

        <h3 id="😋-True-Random"   >
          <a href="#😋-True-Random" class="heading-link"><i class="fas fa-link"></i></a><a href="#😋-True-Random" class="headerlink" title="[😋] True Random"></a>[😋] True Random</h3>
      <p>代码如下</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;cnss&#123;......&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">seeds = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(flag)):</span><br><span class="line">    seeds.append(random.randint(<span class="number">0</span>, <span class="number">10000</span>))</span><br><span class="line"></span><br><span class="line">res = [<span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(flag)):</span><br><span class="line">    random.seed(seeds[i])</span><br><span class="line">    rands = []</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">4</span>):</span><br><span class="line">        rands.append(random.randint(<span class="number">0</span>, <span class="number">255</span>))</span><br><span class="line"></span><br><span class="line">    res.append(<span class="built_in">ord</span>(flag[i]) ^ rands[i % <span class="number">4</span>] ^ res[i])</span><br><span class="line">    <span class="keyword">del</span> rands[i % <span class="number">4</span>]</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">str</span>(rands))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(seeds)</span><br><span class="line"><span class="built_in">print</span>(res[<span class="number">1</span>:])</span><br><span class="line"></span><br><span class="line"><span class="comment">#[6756, 949, 8167, 2246, 9307, 4748, 9651, 1460, 3867, 5744, 5815, 713, 1057, 5614, 4024, 8075, 3862, 732, 279, 5308, 7815, 2251, 5533, 6324, 6786, 8549, 4421, 6651, 7409, 4880, 6246, 1249, 192, 4099, 1704, 3678, 7520, 1378, 2642, 9154, 5690, 8621, 1717, 4992, 8903, 1608, 3214, 2565, 3146, 2521, 2070, 1047, 5784, 8682, 1057, 1091, 8655, 2957, 8591, 1284, 9162, 2974, 9395]</span></span><br><span class="line"><span class="comment">#[8, 221, 50, 176, 21, 79, 19, 208, 117, 8, 51, 171, 156, 247, 101, 60, 46, 152, 162, 182, 29, 16, 102, 154, 22, 117, 65, 21, 121, 197, 170, 2, 217, 118, 201, 15, 132, 246, 21, 1, 250, 7, 45, 130, 124, 231, 200, 103, 7, 63, 86, 159, 211, 168, 82, 11, 60, 173, 209, 168, 191, 255, 101]</span></span><br><span class="line"><span class="comment">#[245, 9, 243] [172, 160, 136] [23, 160, 158] [22, 128, 253] [43, 4, 130] [99, 42, 16] [171, 168, 108] [196, 148, 162] [229, 40, 88] [131, 92, 63] [194, 214, 44] [199, 145, 186] [210, 183, 113] [53, 244, 60] [177, 17, 151] [138, 188, 113] [129, 43, 241] [61, 127, 37] [210, 181, 250] [42, 226, 165] [104, 249, 247] [23, 153, 232] [156, 114, 5] [134, 65, 64] [225, 236, 36] [88, 14, 254] [232, 68, 58] [37, 197, 70] [126, 199, 207] [73, 0, 249] [91, 228, 182] [117, 81, 89] [153, 44, 238] [192, 12, 184] [116, 53, 67] [137, 25, 136] [83, 179, 128] [6, 225, 201] [89, 151, 47] [103, 173, 16] [160, 247, 223] [83, 63, 83] [88, 117, 59] [124, 121, 180] [160, 239, 98] [92, 189, 95] [157, 245, 5] [53, 164, 247] [223, 174, 68] [129, 4, 226] [199, 51, 42] [40, 132, 192] [217, 209, 235] [90, 192, 239] [82, 210, 113] [184, 18, 139] [232, 133, 100] [14, 90, 39] [180, 28, 252] [254, 247, 77] [21, 183, 150] [18, 222, 6] [27, 22, 247]</span></span><br></pre></td></tr></table></div></figure>
<p>考察随机数种子与异或运算，利用 $seeds$ 和 $ res$ 生成完整的 $rands$ 后再异或运算即可得到flag。解密时记得把 $res$ 首位的 $0$ 加上</p>
<p>解密代码如下：</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">seeds = [<span class="number">6756</span>, <span class="number">949</span>, <span class="number">8167</span>, <span class="number">2246</span>, <span class="number">9307</span>, <span class="number">4748</span>, <span class="number">9651</span>, <span class="number">1460</span>, <span class="number">3867</span>, <span class="number">5744</span>, <span class="number">5815</span>, <span class="number">713</span>, <span class="number">1057</span>, <span class="number">5614</span>, <span class="number">4024</span>, <span class="number">8075</span>, <span class="number">3862</span>, <span class="number">732</span>, <span class="number">279</span>, <span class="number">5308</span>, <span class="number">7815</span>, <span class="number">2251</span>, <span class="number">5533</span>, <span class="number">6324</span>, <span class="number">6786</span>, <span class="number">8549</span>, <span class="number">4421</span>, <span class="number">6651</span>, <span class="number">7409</span>, <span class="number">4880</span>, <span class="number">6246</span>, <span class="number">1249</span>, <span class="number">192</span>, <span class="number">4099</span>, <span class="number">1704</span>, <span class="number">3678</span>, <span class="number">7520</span>, <span class="number">1378</span>, <span class="number">2642</span>, <span class="number">9154</span>, <span class="number">5690</span>, <span class="number">8621</span>, <span class="number">1717</span>, <span class="number">4992</span>, <span class="number">8903</span>, <span class="number">1608</span>, <span class="number">3214</span>, <span class="number">2565</span>, <span class="number">3146</span>, <span class="number">2521</span>, <span class="number">2070</span>, <span class="number">1047</span>, <span class="number">5784</span>, <span class="number">8682</span>, <span class="number">1057</span>, <span class="number">1091</span>, <span class="number">8655</span>, <span class="number">2957</span>, <span class="number">8591</span>, <span class="number">1284</span>, <span class="number">9162</span>, <span class="number">2974</span>, <span class="number">9395</span>]</span><br><span class="line">res = [<span class="number">0</span>, <span class="number">8</span>, <span class="number">221</span>, <span class="number">50</span>, <span class="number">176</span>, <span class="number">21</span>, <span class="number">79</span>, <span class="number">19</span>, <span class="number">208</span>, <span class="number">117</span>, <span class="number">8</span>, <span class="number">51</span>, <span class="number">171</span>, <span class="number">156</span>, <span class="number">247</span>, <span class="number">101</span>, <span class="number">60</span>, <span class="number">46</span>, <span class="number">152</span>, <span class="number">162</span>, <span class="number">182</span>, <span class="number">29</span>, <span class="number">16</span>, <span class="number">102</span>, <span class="number">154</span>, <span class="number">22</span>, <span class="number">117</span>, <span class="number">65</span>, <span class="number">21</span>, <span class="number">121</span>, <span class="number">197</span>, <span class="number">170</span>, <span class="number">2</span>, <span class="number">217</span>, <span class="number">118</span>, <span class="number">201</span>, <span class="number">15</span>, <span class="number">132</span>, <span class="number">246</span>, <span class="number">21</span>, <span class="number">1</span>, <span class="number">250</span>, <span class="number">7</span>, <span class="number">45</span>, <span class="number">130</span>, <span class="number">124</span>, <span class="number">231</span>, <span class="number">200</span>, <span class="number">103</span>, <span class="number">7</span>, <span class="number">63</span>, <span class="number">86</span>, <span class="number">159</span>, <span class="number">211</span>, <span class="number">168</span>, <span class="number">82</span>, <span class="number">11</span>, <span class="number">60</span>, <span class="number">173</span>, <span class="number">209</span>, <span class="number">168</span>, <span class="number">191</span>, <span class="number">255</span>, <span class="number">101</span>]</span><br><span class="line">length = <span class="number">63</span></span><br><span class="line">flag1 = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length):</span><br><span class="line">    seed = seeds[i]</span><br><span class="line">    random.seed(seed)</span><br><span class="line">    rands = []</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">4</span>):</span><br><span class="line">        rands.append(random.randint(<span class="number">0</span>, <span class="number">255</span>))</span><br><span class="line">    flag1.append(<span class="built_in">chr</span>(res[i+<span class="number">1</span>] ^ rands[i % <span class="number">4</span>] ^ res[i]))</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span>.join(i <span class="keyword">for</span> i <span class="keyword">in</span> flag1)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></div></figure>
<p>得到flag：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnss&#123;Trust me!This is turely random!!!!TURELY RANDOMMMMMM!!!!!&#125;</span><br></pre></td></tr></table></div></figure>

        <h3 id="😋-基地遭到攻击"   >
          <a href="#😋-基地遭到攻击" class="heading-link"><i class="fas fa-link"></i></a><a href="#😋-基地遭到攻击" class="headerlink" title="[😋] 基地遭到攻击"></a>[😋] 基地遭到攻击</h3>
      <p>先贴代码</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">msg = <span class="string">&#x27;&#x27;</span></span><br><span class="line">dic = <span class="string">&#x27;0987654321qwertyuioplkjhgfdsazxcvbnmQWERTYUIOPLKJHGFDSAZXCVBNM!@#$%^&amp;*-=+:;()&#123;&#125;&lt;&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dec_to_ter</span>(<span class="params">num</span>):</span><br><span class="line">    l = []</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        num, reminder = <span class="built_in">divmod</span>(num, <span class="number">3</span>)</span><br><span class="line">        l.append(<span class="built_in">str</span>(reminder))</span><br><span class="line">        <span class="keyword">if</span> num == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join(l[::-<span class="number">1</span>]).zfill(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ter_to_dec</span>(<span class="params">st</span>):</span><br><span class="line">    num = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(st)):</span><br><span class="line">        num += <span class="number">3</span>**(<span class="built_in">len</span>(st) - i - <span class="number">1</span>) * <span class="built_in">int</span>(st[i])</span><br><span class="line">    <span class="keyword">return</span> num</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cy = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(msg) // <span class="number">3</span>):</span><br><span class="line">    st = <span class="string">&#x27;0&#x27;</span> + dec_to_ter(<span class="built_in">ord</span>(msg[<span class="number">3</span> * i])) + dec_to_ter(<span class="built_in">ord</span>(</span><br><span class="line">        msg[<span class="number">3</span> * i + <span class="number">1</span>])) + dec_to_ter(<span class="built_in">ord</span>(msg[<span class="number">3</span> * i + <span class="number">2</span>]))</span><br><span class="line">    cy += dic[ter_to_dec(st[:<span class="number">4</span>])] + dic[ter_to_dec(st[<span class="number">4</span>:<span class="number">8</span>])] + dic[ter_to_dec(</span><br><span class="line">        st[<span class="number">8</span>:<span class="number">12</span>])] + dic[ter_to_dec(st[<span class="number">12</span>:<span class="number">16</span>])]</span><br><span class="line">res = <span class="string">&#x27;0&#x27;</span> + <span class="string">&#x27;&#x27;</span>.join([dec_to_ter(<span class="built_in">ord</span>(msg[i])) <span class="keyword">for</span> i <span class="keyword">in</span> st[<span class="built_in">len</span>(msg) // <span class="number">3</span> * <span class="number">3</span>:]])</span><br><span class="line">res += <span class="string">&#x27;0&#x27;</span> * ((<span class="built_in">len</span>(res) // <span class="number">4</span> + <span class="number">1</span>) * <span class="number">4</span> - <span class="built_in">len</span>(res))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(res) // <span class="number">4</span>):</span><br><span class="line">    cy += dic[<span class="number">4</span> * i:<span class="number">4</span> * i + <span class="number">4</span>]</span><br><span class="line"><span class="built_in">print</span>(cy)</span><br><span class="line"></span><br><span class="line"><span class="comment">#eJ:zwWufwZuYwHsvelcawj9le^jxwCMb7HjhwZuYwJMz7JVl7Hugq^3j7Zob1)qQeZuke7Hj7J:n4RZze^jU1x-ge%Ige%IuqHjmeCHzwRMte^nge(ZhqHqkqKWue%MO0987</span></span><br></pre></td></tr></table></div></figure>
<p>忘了怎么做了，先把解题代码放上来，后面再看</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">dec_to_ter</span>(<span class="params">num</span>):  <span class="comment"># 十进制转三进制（保留4位）</span></span><br><span class="line">    l = []</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        num, reminder = <span class="built_in">divmod</span>(num, <span class="number">3</span>)</span><br><span class="line">        l.append(<span class="built_in">str</span>(reminder))</span><br><span class="line">        <span class="keyword">if</span> num == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join(l[::-<span class="number">1</span>]).zfill(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ter_to_dec</span>(<span class="params">st</span>):  <span class="comment"># 三进制转十进制（输入字符串）</span></span><br><span class="line">    num = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(st)):</span><br><span class="line">        num += <span class="number">3</span>**(<span class="built_in">len</span>(st) - i - <span class="number">1</span>) * <span class="built_in">int</span>(st[i])</span><br><span class="line">    <span class="keyword">return</span> num</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dic = <span class="string">&#x27;0987654321qwertyuioplkjhgfdsazxcvbnmQWERTYUIOPLKJHGFDSAZXCVBNM!@#$%^&amp;*-=+:;()&#123;&#125;&lt;&gt;&#x27;</span></span><br><span class="line">cy = <span class="string">&#x27;eJ:zwWufwZuYwHsvelcawj9le^jxwCMb7HjhwZuYwJMz7JVl7Hugq^3j7Zob1)qQeZuke7Hj7J:n4RZze^jU1x-ge%Ige%IuqHjmeCHzwRMte^nge(ZhqHqkqKWue%MO0987&#x27;</span></span><br><span class="line">msgs = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(cy)//<span class="number">4</span>):</span><br><span class="line">    s = cy[i*<span class="number">4</span>:i*<span class="number">4</span>+<span class="number">4</span>]</span><br><span class="line">    st = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> s:</span><br><span class="line">        st += <span class="built_in">str</span>(dec_to_ter(dic.index(n)))</span><br><span class="line">        </span><br><span class="line">    msgs += st[<span class="number">1</span>::]</span><br><span class="line"></span><br><span class="line">msg = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(msgs)//<span class="number">5</span>):</span><br><span class="line">    pd = msgs[i*<span class="number">5</span>:i*<span class="number">5</span>+<span class="number">5</span>]</span><br><span class="line">    msg += <span class="built_in">chr</span>(ter_to_dec(pd))</span><br><span class="line"><span class="built_in">print</span>(msg)</span><br></pre></td></tr></table></div></figure>
<p>运行结果：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qing ji zhu n@melessoier shi zhen de qiang!!!Your flag is:cnss&#123;This_is_a_strange_switch_of_Base&#125; ¥</span><br></pre></td></tr></table></div></figure>

        <h3 id="😋-😗-2-Smooth-Criminal"   >
          <a href="#😋-😗-2-Smooth-Criminal" class="heading-link"><i class="fas fa-link"></i></a><a href="#😋-😗-2-Smooth-Criminal" class="headerlink" title="[(😋+😗)/2] Smooth Criminal"></a>[(😋+😗)/2] Smooth Criminal</h3>
      <p>代码</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">msg = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">g = <span class="number">23</span></span><br><span class="line">p = <span class="number">335215034881592512312398694238485179340610060759881511231472142277527176340784432381542726029524727833039074808456839870641607412102746854257629226877248337002993023452385472058106944014653401647033456174126976474875859099023703472904735779212010820524934972736276889281087909166017427905825553503050645575935980580803899122224368875197728677516907272452047278523846912786938173456942568602502013001099009776563388736434564541041529106817380347284002060811645842312648498340150736573246893588079033524476111268686138924892091575797329915240849862827621736832883215569687974368499436632617425922744658912248644475097139485785819369867604176912652851123185884810544172785948158330991257118563772736929105360124222843930130347670027236797458715653361366862282591170630650344062377644570729478796795124594909835004189813214758026703689710017334501371279295621820181402191463184275851324378938021156631501330660825566054528793444353</span></span><br><span class="line">x = bytes_to_long(msg)</span><br><span class="line">h = <span class="built_in">pow</span>(g,x,p)</span><br><span class="line"><span class="built_in">print</span>(h)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">284807206758690260674168635652206676153199531206012399963212250117387237611215360933500261515214683228087961018802214033227875404285999805861378064908267139553648162291537289278610803697593790816897557638428568100928359466319989545031886032567685512341977270979526717345142165708163150135333252686395591140161831940144432170025393466325742577593887920556316984992847396283579269633262200726954355227038902620716137491876506054110491178240133590849734496335712064335802238492192883394892712228203054091984354156897863240197296165162563130406991577815765695750522464228829570550025932368633890216042941018677666517405480771960616480812214562091924764071878808127451559388368257581409875583275118825609722046677620382418300990385176438231226653889407671404650316193783984038250699566770765090427892884433879512806495203724706133916982135893710559405918247360707377685182171666477087313942829242876879340985182675501598869126412636</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></div></figure>
<p>离散对数问题，题目已经暗示 $p-1$ 是一个光滑数，显然是想考察 $Pohilg_Hellman$ 算法。</p>
<p>直接扔进 $sage$ 求解偷一波懒。    sage yyds! (bushi</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">h = <span class="number">284807206758690260674168635652206676153199531206012399963212250117387237611215360933500261515214683228087961018802214033227875404285999805861378064908267139553648162291537289278610803697593790816897557638428568100928359466319989545031886032567685512341977270979526717345142165708163150135333252686395591140161831940144432170025393466325742577593887920556316984992847396283579269633262200726954355227038902620716137491876506054110491178240133590849734496335712064335802238492192883394892712228203054091984354156897863240197296165162563130406991577815765695750522464228829570550025932368633890216042941018677666517405480771960616480812214562091924764071878808127451559388368257581409875583275118825609722046677620382418300990385176438231226653889407671404650316193783984038250699566770765090427892884433879512806495203724706133916982135893710559405918247360707377685182171666477087313942829242876879340985182675501598869126412636</span></span><br><span class="line">g = <span class="number">23</span></span><br><span class="line">p = <span class="number">335215034881592512312398694238485179340610060759881511231472142277527176340784432381542726029524727833039074808456839870641607412102746854257629226877248337002993023452385472058106944014653401647033456174126976474875859099023703472904735779212010820524934972736276889281087909166017427905825553503050645575935980580803899122224368875197728677516907272452047278523846912786938173456942568602502013001099009776563388736434564541041529106817380347284002060811645842312648498340150736573246893588079033524476111268686138924892091575797329915240849862827621736832883215569687974368499436632617425922744658912248644475097139485785819369867604176912652851123185884810544172785948158330991257118563772736929105360124222843930130347670027236797458715653361366862282591170630650344062377644570729478796795124594909835004189813214758026703689710017334501371279295621820181402191463184275851324378938021156631501330660825566054528793444353</span></span><br><span class="line">d = discrete_log(h,mod(g, p))</span><br><span class="line"><span class="built_in">print</span>(d)</span><br></pre></td></tr></table></div></figure>
<p>得到flag：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnss&#123;You_have_got_Pohilg_Hellman!&#125;</span><br></pre></td></tr></table></div></figure>

        <h3 id="😗-ECDLP"   >
          <a href="#😗-ECDLP" class="heading-link"><i class="fas fa-link"></i></a><a href="#😗-ECDLP" class="headerlink" title="[😗] ECDLP"></a>[😗] ECDLP</h3>
      <p>代码：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">from Crypto.Util.number import bytes_to_long</span><br><span class="line">M = 93556643250795678718734474880013829509320385402690660619699653921022012489089</span><br><span class="line">A = 66001598144012865876674115570268990806314506711104521036747533612798434904785</span><br><span class="line">B = 25255205054024371783896605039267101837972419055969636393425590261926131199030</span><br><span class="line">P = (56027910981442853390816693056740903416379421186644480759538594137486160388926, 65533262933617146434438829354623658858649726233622196512439589744498050226926)</span><br><span class="line">F = FiniteField(M)</span><br><span class="line">E = EllipticCurve(F,[A,B])</span><br><span class="line">P = E.point(P)</span><br><span class="line">key = b&#x27;fake_key&#x27;</span><br><span class="line">flag = b&#x27;cnss&#123;&#x27;+ key +b&#x27;&#125;&#x27;</span><br><span class="line">key = bytes_to_long(key)</span><br><span class="line">assert(len(bin(key))&lt;100)</span><br><span class="line">Q = key * P</span><br><span class="line">print(Q)</span><br></pre></td></tr></table></div></figure>
<p>一道简单的ECDLP问题，考察 $Pohlig_Hellman$ 算法</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">M = 93556643250795678718734474880013829509320385402690660619699653921022012489089</span><br><span class="line">A = 66001598144012865876674115570268990806314506711104521036747533612798434904785</span><br><span class="line">B = 25255205054024371783896605039267101837972419055969636393425590261926131199030</span><br><span class="line">P = (56027910981442853390816693056740903416379421186644480759538594137486160388926, 65533262933617146434438829354623658858649726233622196512439589744498050226926)</span><br><span class="line">Q = (45327498586483906413153672412174634093375862785049326580296250293031012757729, 92851637248675027432500221064266708706584869653830467154078497414427393871661)</span><br><span class="line">F = FiniteField(M)</span><br><span class="line">E = EllipticCurve(F,[A,B])</span><br><span class="line">P = E.point(P)</span><br><span class="line">Q = E.point(Q)</span><br><span class="line">factors, exponents = zip(*factor(P.order()))</span><br><span class="line">primes = [factors[i] ^ exponents[i] for i in range(len(factors))][:-2]</span><br><span class="line">dlogs = []</span><br><span class="line">for fac in primes:</span><br><span class="line">    t = int(P.order()) // int(fac)</span><br><span class="line">    dlog = discrete_log(t*Q,t*P,operation=&quot;+&quot;)</span><br><span class="line">    dlogs += [dlog]</span><br><span class="line">    print(&quot;factor: &quot;+str(fac)+&quot;, Discrete Log: &quot;+str(dlog)) #calculates discrete logarithm for each prime order</span><br><span class="line"></span><br><span class="line">key = crt(dlogs,primes)</span><br><span class="line">print(key)</span><br></pre></td></tr></table></div></figure>
<p>求出key后扔进IDLE转回bytes类型得到flag：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnss&#123;S4G3&amp;P0h1i9&#125;</span><br></pre></td></tr></table></div></figure>

        <h3 id="😗-那个男人！！！"   >
          <a href="#😗-那个男人！！！" class="heading-link"><i class="fas fa-link"></i></a><a href="#😗-那个男人！！！" class="headerlink" title="[😗] 那个男人！！！"></a>[😗] 那个男人！！！</h3>
      <p>万恶的纯猜题/(ㄒoㄒ)/~~</p>
<p>先看代码</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long, getPrime</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> signal</span><br><span class="line"><span class="keyword">import</span> socketserver</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> urandom</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;cnss&#123;......&#125;&#x27;</span></span><br><span class="line">Bits = <span class="number">256</span></span><br><span class="line"></span><br><span class="line">banner = <span class="string">br&#x27;&#x27;&#x27;[+] Big hacker MMonster is cracking a communications system.</span></span><br><span class="line"><span class="string">[+] Can you help him decrypt the secret?</span></span><br><span class="line"><span class="string">[+] MMonster will give you a flag in return.</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">menu = <span class="string">br&#x27;&#x27;&#x27;[+] 1.Get your gift</span></span><br><span class="line"><span class="string">[+] 2.Give me the secret</span></span><br><span class="line"><span class="string">[+] Give me your choice:&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Task</span>(socketserver.BaseRequestHandler):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, *args, **kargs</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(*args, **kargs)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">proof_of_work</span>(<span class="params">self</span>):</span><br><span class="line">        random.seed(urandom(<span class="number">8</span>))</span><br><span class="line">        proof = <span class="string">&#x27;&#x27;</span>.join([</span><br><span class="line">            random.choice(string.ascii_letters + string.digits)</span><br><span class="line">            <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>)</span><br><span class="line">        ])</span><br><span class="line">        digest = sha256(proof.encode()).hexdigest()</span><br><span class="line">        self.dosend(</span><br><span class="line">            <span class="built_in">str</span>.encode((<span class="string">&quot;[+] sha256(XXXX + %s) == %s&quot;</span> % (proof[<span class="number">4</span>:], digest))))</span><br><span class="line">        self.send(<span class="built_in">str</span>.encode(<span class="string">&#x27;[+] Give me XXXX:&#x27;</span>))</span><br><span class="line">        x = self.request.recv(<span class="number">10</span>)</span><br><span class="line">        x = (x.strip()).decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(x) != <span class="number">4</span> <span class="keyword">or</span> sha256(</span><br><span class="line">            (x + proof[<span class="number">4</span>:]).encode()).hexdigest() != digest:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">dosend</span>(<span class="params">self, msg</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.request.sendall(msg + <span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send</span>(<span class="params">self, msg</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.request.sendall(msg)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">read_line</span>(<span class="params">self</span>):</span><br><span class="line">        body = <span class="string">b&quot;&quot;</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            ch = self.request.recv(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> ch == <span class="string">b&quot;\n&quot;</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            body = body + ch</span><br><span class="line">        <span class="keyword">return</span> body</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">timeout_handler</span>(<span class="params">self, signum, frame</span>):</span><br><span class="line">        <span class="keyword">raise</span> TimeoutError</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            signal.alarm(<span class="number">120</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self.proof_of_work():</span><br><span class="line">                self.dosend(<span class="string">b&#x27;[!] You must pass the PoW!&#x27;</span>)</span><br><span class="line">                self.request.close()</span><br><span class="line">            t = <span class="built_in">len</span>(flag) * random.randint(<span class="number">4</span>, <span class="number">8</span>)</span><br><span class="line">            Con = [getPrime(Bits // <span class="number">2</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(t)]</span><br><span class="line">            secret = getPrime(Bits)</span><br><span class="line">            p = getPrime(Bits)</span><br><span class="line">            self.send(banner)</span><br><span class="line">            self.dosend(<span class="string">f&quot;[+] p = <span class="subst">&#123;p&#125;</span>&quot;</span>.encode())</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                self.send(menu)</span><br><span class="line">                choice = self.read_line()</span><br><span class="line">                <span class="keyword">if</span> (choice == <span class="string">b&quot;1&quot;</span>):</span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        num = random.randint(<span class="number">1</span>, p)</span><br><span class="line">                        result = secret</span><br><span class="line">                        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(t):</span><br><span class="line">                            result += Con[i] * <span class="built_in">pow</span>(num, i + <span class="number">1</span>, p) % p</span><br><span class="line">                        result = result % p</span><br><span class="line">                        self.dosend(<span class="string">b&quot;[+] Here is your gift:&quot;</span>)</span><br><span class="line">                        self.dosend(<span class="string">f&quot;[+] (<span class="subst">&#123;num&#125;</span>, <span class="subst">&#123;result&#125;</span>)&quot;</span>.encode())</span><br><span class="line">                    <span class="keyword">except</span>:</span><br><span class="line">                        self.dosend(<span class="string">b&#x27;[!] ERROR&#x27;</span>)</span><br><span class="line">                <span class="keyword">elif</span> (choice == <span class="string">b&#x27;2&#x27;</span>):</span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        self.send(<span class="string">b&#x27;[+] The secret: &#x27;</span>)</span><br><span class="line">                        ans = self.read_line()</span><br><span class="line">                        <span class="keyword">if</span> (<span class="built_in">int</span>(ans) == secret):</span><br><span class="line">                            self.dosend(</span><br><span class="line">                                <span class="string">b&#x27;[+] Congratulations! You successfully cracked the system&#x27;</span></span><br><span class="line">                            )</span><br><span class="line">                            self.dosend(</span><br><span class="line">                                <span class="string">f&#x27;[+] Here is your flag: <span class="subst">&#123;flag&#125;</span>&#x27;</span>.encode())</span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            self.dosend(<span class="string">b&#x27;[+] You are wrong&#x27;</span>)</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                    <span class="keyword">except</span>:</span><br><span class="line">                        self.dosend(<span class="string">b&#x27;[!] ERROR&#x27;</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    self.dosend(<span class="string">b&#x27;[!] Please follow the rule!&#x27;</span>)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> TimeoutError:</span><br><span class="line">            self.dosend(<span class="string">b&#x27;[!] Timeout!&#x27;</span>)</span><br><span class="line">            self.request.close()</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            self.dosend(<span class="string">b&#x27;[!] Whats wrong???&#x27;</span>)</span><br><span class="line">            self.request.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ThreadedServer</span>(socketserver.ForkingMixIn, socketserver.TCPServer):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    HOST, PORT = <span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">9999</span></span><br><span class="line">    server = ThreadedServer((HOST, PORT), Task)</span><br><span class="line">    server.allow_reuse_address = <span class="literal">True</span></span><br><span class="line">    server.serve_forever()</span><br></pre></td></tr></table></div></figure>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc 101.32.29.195 9999</span><br></pre></td></tr></table></div></figure>
<p>首先是常规的 $proof_of_work$ ，暴力破解即可</p>
<p>进入系统后有两种操作可选</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[+] <span class="number">1.</span>Get your gift</span><br><span class="line">[+] <span class="number">2.</span>Give me the secret</span><br><span class="line">[+] Give me your choice:</span><br></pre></td></tr></table></div></figure>
<p>操作 $2$ 后发送正确的 $secret$ 就可以得到 $flag$</p>
<p>操作 $1$ 后系统会生成一个随机的 $num$ 代入一个 $t$ 次同余多项式进行运算得到 $result$，然后给出 $num$ 和 $result$，其中多项式的常数项就是我们要求的 $secret$</p>
<p>其中选择 $1$ 可以重复选择，由此可以通过不断地选择操作 $1$ 来得到 $t$ 组$num$ 和 $result$，然后构建出一个 $t$ 维的线性方程组来求解得到 $secret$</p>
<p>最后需要解决的问题就是这个 $t$，$len(flag)$ 未知且每次运行还会生成随机数。。。</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t = len(flag) * random.randint(4, 8)</span><br></pre></td></tr></table></div></figure>
<p>刚开始脑子抽了在手动猜，失败无数次后心态发生了亿点点变化（</p>
<p>后面利用python里的os包来进行自动运行，尝试到 $len(flag)=45$ 时得到flag</p>
<p>对于求解 $flag$，最初手写了一个模条件下的简易高斯消元来求解，得到flag后发现好像想要考察的是拉格朗日插值法</p>
<p>完整解题代码如下：</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> gcd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ext_gcd</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>, <span class="number">0</span>, a</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        x, y, d = ext_gcd(b, a % b)</span><br><span class="line">        x, y = y, (x - (a // b) * y)</span><br><span class="line">        <span class="keyword">return</span> x, y, d</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">set_matrix</span>(<span class="params">nums, results, t, q</span>):</span><br><span class="line">    matrix = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(t + <span class="number">1</span>):</span><br><span class="line">        rows = []</span><br><span class="line">        num = nums[i]</span><br><span class="line">        result = results[i]</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(t):</span><br><span class="line">            rows.append(<span class="built_in">pow</span>(num, k + <span class="number">1</span>, q))</span><br><span class="line">        rows.append(<span class="number">1</span>)</span><br><span class="line">        rows.append(result)</span><br><span class="line">        matrix.append(rows)</span><br><span class="line">    <span class="keyword">return</span> matrix</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_secret</span>(<span class="params">matrix, t, q</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(t):</span><br><span class="line">        <span class="keyword">if</span> matrix[i][i] != <span class="number">1</span>:</span><br><span class="line">            s1 = ext_gcd(matrix[i][i], q)[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i, t + <span class="number">2</span>):</span><br><span class="line">                matrix[i][j] = (matrix[i][j] * s1) % q</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(i + <span class="number">1</span>, t + <span class="number">1</span>):</span><br><span class="line">            s2 = matrix[k][i]</span><br><span class="line">            <span class="keyword">for</span> l <span class="keyword">in</span> <span class="built_in">range</span>(i, t + <span class="number">2</span>):</span><br><span class="line">                matrix[k][l] = (matrix[k][l] - matrix[i][l] * s2) % q</span><br><span class="line">    d = ext_gcd(matrix[t][t], q)[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> (matrix[t][t + <span class="number">1</span>] * d) % q</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&quot;101.32.29.195&quot;</span>, <span class="number">9999</span>)</span><br><span class="line">TOTAL = <span class="number">20</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">myhash</span>(<span class="params">text</span>):</span><br><span class="line">    mysha = hashlib.sha256()</span><br><span class="line">    mysha.update(text)</span><br><span class="line">    <span class="keyword">return</span> mysha.hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">passPoW</span>(<span class="params">plain, cipher</span>):</span><br><span class="line">    dic = string.digits+string.ascii_letters</span><br><span class="line">    <span class="keyword">for</span> a0 <span class="keyword">in</span> dic:</span><br><span class="line">        <span class="keyword">for</span> a1 <span class="keyword">in</span> dic:</span><br><span class="line">            <span class="keyword">for</span> a2 <span class="keyword">in</span> dic:</span><br><span class="line">                <span class="keyword">for</span> a3 <span class="keyword">in</span> dic:</span><br><span class="line">                    tmp = (a0+a1+a2+a3+plain).encode()</span><br><span class="line">                    <span class="keyword">if</span> myhash(tmp) == cipher:</span><br><span class="line">                        <span class="keyword">return</span> a0+a1+a2+a3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># pass the PoW</span></span><br><span class="line">    recv = p.recvline().decode()</span><br><span class="line">    <span class="built_in">print</span>(recv.strip())</span><br><span class="line">    plain = recv[<span class="number">18</span>:<span class="number">34</span>]</span><br><span class="line">    cipher = recv[<span class="number">39</span>:-<span class="number">1</span>]</span><br><span class="line">    <span class="built_in">print</span>(plain, cipher)</span><br><span class="line">    res = passPoW(plain, cipher)</span><br><span class="line">    <span class="built_in">print</span>(p.recvuntil(<span class="string">&quot;Give me XXXX:&quot;</span>.encode()))</span><br><span class="line">    p.sendline(res.encode())</span><br><span class="line">    <span class="built_in">print</span>(res + plain)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        recv = p.recvline().decode()</span><br><span class="line">        <span class="built_in">print</span>(recv.strip())</span><br><span class="line">    q = <span class="built_in">int</span>(recv[<span class="number">8</span>:-<span class="number">1</span>])</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;q = &#x27;</span> + <span class="built_in">str</span>(q))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">        recv = p.recvline().decode()</span><br><span class="line">        <span class="comment"># print(recv.strip())</span></span><br><span class="line"></span><br><span class="line">    t = <span class="number">45</span> * <span class="number">5</span></span><br><span class="line">    nums = []</span><br><span class="line">    results = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(t+<span class="number">1</span>):</span><br><span class="line">        p.sendline(<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">            recv = p.recvline().decode()</span><br><span class="line">            <span class="comment"># print(recv.strip())</span></span><br><span class="line">        gift = recv[<span class="number">5</span>:-<span class="number">2</span>].split(<span class="string">&#x27;, &#x27;</span>)</span><br><span class="line">        nums.append(<span class="built_in">int</span>(gift[<span class="number">0</span>]))</span><br><span class="line">        results.append(<span class="built_in">int</span>(gift[<span class="number">1</span>]))</span><br><span class="line">        <span class="comment"># print(&#x27;num = &#x27; + gift[0], &#x27;\nresult = &#x27; + gift[1])</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">            recv = p.recvline().decode()</span><br><span class="line">            <span class="comment"># print(recv.strip())</span></span><br><span class="line"></span><br><span class="line">    matrix = set_matrix(nums, results, t, q)</span><br><span class="line">    secret = find_secret(matrix, t, q)</span><br><span class="line">    <span class="built_in">print</span>(secret)</span><br><span class="line">    p.sendline(<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(secret).encode())</span><br><span class="line">    recv = p.recvline().decode()</span><br><span class="line">    <span class="built_in">print</span>(recv.strip())</span><br><span class="line">    <span class="built_in">print</span>(recv.strip())</span><br><span class="line">    <span class="built_in">print</span>(recv.strip())</span><br><span class="line">    <span class="built_in">print</span>(recv.strip())</span><br><span class="line">    recv = p.recvline().decode()</span><br><span class="line">    <span class="built_in">print</span>(recv.strip())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></div></figure>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">    run = <span class="string">&#x27;python p7_writeup.py&#x27;</span></span><br><span class="line">    a = os.system(run)</span><br><span class="line">    <span class="built_in">print</span>(a)</span><br><span class="line">    <span class="keyword">if</span> a != <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></div></figure>
<p>flag：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnss&#123;Lagrange_i5_one_of_My_favour1te&#125;</span><br></pre></td></tr></table></div></figure>

        <h3 id="😗-RSA-I"   >
          <a href="#😗-RSA-I" class="heading-link"><i class="fas fa-link"></i></a><a href="#😗-RSA-I" class="headerlink" title="[😗] RSA I"></a>[😗] RSA I</h3>
      <p>事RSA！</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">n = p * q</span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">pow</span>(bytes_to_long(flag) , e , n))</span><br><span class="line"></span><br><span class="line">_p = <span class="built_in">int</span>(<span class="built_in">bin</span>(p)[<span class="number">2</span>:<span class="number">258</span>]+<span class="built_in">bin</span>(p)[<span class="number">258</span>:][::-<span class="number">1</span>],<span class="number">2</span>) </span><br><span class="line">_q = <span class="built_in">int</span>(<span class="built_in">bin</span>(q)[<span class="number">258</span>:][::-<span class="number">1</span>]+<span class="built_in">bin</span>(q)[<span class="number">2</span>:<span class="number">258</span>],<span class="number">2</span>) </span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(_p ^ _q)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">128966867931621017951402141152350515585922701101703171805286229280649080647456092995914584397246443887423499663793458719282451496996613304284219288980124348105720917541598445131650977064828807037484823828553004028415721038165820372738002173903655842610359239877763360519229606532878770232406532771135170997013</span></span><br><span class="line"><span class="string">5690662746178266479325698709275119693770487802124577299826695176054941202523665055025450322208031101907866334556059314241344084994180738805538046733994924313334723193790887926979826447385190012967272407294079552678501721130119836521906772578870744755554658825724748264427246566006927477363674507384245147796</span></span><br><span class="line"><span class="string">5334584593664858319670147545831540027620360712512679965236952968664258458326815898964419736009663358894095508398927605649898980377954463431300198964796146</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></div></figure>
<p>难点在于通过 $p*q$ 和 $_p\bigoplus_q$ 来分解 $p,q$</p>
<p>观察发现，把 $_p\bigoplus_q$ 的后256位反向后可以得到 $p\bigoplus q_f$，个人感觉应该是要利用异或限制来暴力分解 $p,q$，但是思考后没能实现算法</p>
<p>刚开始在CTFtime上找到一道类似的rsa题目<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://ctftime.org/task/15578" >PlaidCTF 2021 / xorsa</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>，但是这道题中的限制条件是 $p\bigoplus q$ ，尝试类比，无果</p>
<p>后面单独寻找异或分解终于找到<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/384418167" >GKCTF 2021 / XOR</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>，利用脚本分解 $p,q$ 后常规求解rsa得到flag</p>
<p>不过最后还是没有搞懂原理，招新结束后找个师傅问一哈</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solver</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, x, n</span>):</span><br><span class="line">        self.x = x</span><br><span class="line">        self.n = n</span><br><span class="line">        self.pq = [(<span class="number">0</span>, <span class="number">0</span>)]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">self, b, p, q</span>):</span><br><span class="line">        <span class="keyword">if</span> p * q &lt;= n <span class="keyword">and</span> (p | (b - <span class="number">1</span>)) * (q | (b - <span class="number">1</span>)) &gt;= n:</span><br><span class="line">            self.pq.append((p, q))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">solve</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> shift <span class="keyword">in</span> tqdm(<span class="built_in">range</span>(<span class="number">4095</span>, -<span class="number">1</span>, -<span class="number">1</span>)):</span><br><span class="line">            b = <span class="number">1</span> &lt;&lt; shift</span><br><span class="line">            pq, self.pq = self.pq, []</span><br><span class="line">            <span class="keyword">for</span> p, q <span class="keyword">in</span> pq:</span><br><span class="line">                <span class="keyword">if</span> self.x &amp; b:</span><br><span class="line">                    self.add(b, p | b, q)</span><br><span class="line">                    self.add(b, p, q | b)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    self.add(b, p, q)</span><br><span class="line">                    self.add(b, p | b, q | b)</span><br><span class="line">        <span class="keyword">return</span> self.pq[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    x = <span class="number">5334584593664858319670147545831540027620360712512679965236952968664258458326815898964419736009663358894095508398927605649898980377954463431300198964796146</span></span><br><span class="line">    n = <span class="number">128966867931621017951402141152350515585922701101703171805286229280649080647456092995914584397246443887423499663793458719282451496996613304284219288980124348105720917541598445131650977064828807037484823828553004028415721038165820372738002173903655842610359239877763360519229606532878770232406532771135170997013</span></span><br><span class="line">    solver = Solver(x, n)</span><br><span class="line">    p, q = solver.solve()</span><br><span class="line">    <span class="built_in">print</span>(p, q)</span><br></pre></td></tr></table></div></figure>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ext_gcd</span>(<span class="params">a, b</span>):  <span class="comment"># 扩展欧几里得算法</span></span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>, <span class="number">0</span>, a</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        x, y, gcd = ext_gcd(b, a % b)  <span class="comment"># 递归直至余数等于0(需多递归一层用来判断)</span></span><br><span class="line">        x, y = y, (x - (a // b) * y)  <span class="comment"># 辗转相除法反向推导每层a、b的因子使得gcd(a,b)=ax+by成立</span></span><br><span class="line">        <span class="keyword">return</span> x, y, gcd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = <span class="number">12948472548502855475796108830280319241339751876644203406728117021144556144383328664200964459933613907132679575664273588175268439115295754485162100467976557</span></span><br><span class="line">q = <span class="number">9960006282480985513480885672444211883767328748705584719471703464167670477391828270868899276906078628248865861165369352288036643194313864072301868155144009</span></span><br><span class="line">m = <span class="number">5690662746178266479325698709275119693770487802124577299826695176054941202523665055025450322208031101907866334556059314241344084994180738805538046733994924313334723193790887926979826447385190012967272407294079552678501721130119836521906772578870744755554658825724748264427246566006927477363674507384245147796</span></span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = ext_gcd(e, phi)[<span class="number">0</span>]</span><br><span class="line">flag = long_to_bytes(<span class="built_in">pow</span>(m, d, n))</span><br><span class="line"><span class="built_in">print</span>(flag.decode())</span><br></pre></td></tr></table></div></figure>
<p>得到flag：</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnss&#123;st0_Mmons7er_Or2_ajfwiclskjd&#125;</span><br></pre></td></tr></table></div></figure>

        <h3 id="😯-RSA-II"   >
          <a href="#😯-RSA-II" class="heading-link"><i class="fas fa-link"></i></a><a href="#😯-RSA-II" class="headerlink" title="[😯] RSA II"></a>[😯] RSA II</h3>
      <figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">n = 97814568264814384858194701955408461509880555772006698372422205341758322175891474378211599333051180365254844248340812534463000531890490435018379585036704801177155418066770861143206836558793774360498040810255823235715535487716966004194143204900564413879660115112965484824906920141847149888933004740523449213441</span><br><span class="line">e = 93943500165298065499950418373429723509334252629406924973909070866091749987346174290549648466771963135864917881154270768788129489671486923171733460927672763251885052132144244633336183737015936611716827476566876619327956203686756399730968768494676888428137426449681845021696056187478027217734766494935085365973</span><br><span class="line">c = 94824506238324647310189440118275905630079991117300404682731742667903989141279243563467739363969077465823348334409761663544741888528986945132364537746094780678318967503662858734042718154696328032759064617107207652499854549294495304943140505861316519905693752269944653247754307028004160249127852813312325931155</span><br></pre></td></tr></table></div></figure>
<p>题目只给了 $n,e,c$ 三个数据，刚开始看 $e$ 的大小觉得是 $Wiener’s Attack$ 或者 $Boneh and Durfee attack$，尝试失败后陷入了迷茫，然后直接扔factordb发现分解出来了。。。超，大意了</p>
<p>常规解密后得到一个网址</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://files.catbox.moe/eami99.py</span><br></pre></td></tr></table></div></figure>
<p>打开后发现套了一层啊这是</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag,padding</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">e = <span class="number">7</span> </span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">n = p * q</span><br><span class="line"></span><br><span class="line">c1 = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line">c2 = <span class="built_in">pow</span>(m+padding,e,n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(c1)</span><br><span class="line"><span class="built_in">print</span>(c2)</span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">25273007066020189408109545229904933542261476876009872439710113415858837573395525630415777935344105797142851844145072854811848998350900372253971849285971326186079657861753281055419024685971559366012439288855412385839773710368571132729119276524681516954047015289030441158082956015073955156160324687579087140475</span></span><br><span class="line"><span class="string">59742662912819263048476842525911792774606722595876218353030983190479211608519746735628199156539097538888609903705813533259650335449835222582640654777700444326609516992455668845647841850293730999545553827474883338490920161461753350303815384773788647536170704446255770720919964851226435888665577313224159779663</span></span><br><span class="line"><span class="string">67530919003139966773553200011128742490294797009276982165948531486788511785120120505106383097675618844859048245902703407886773958024692000896590916622934616822563863757961613349221514066937957870378716994349709221655837122691033725689519576287720351954630419028668871186060611604084354574970069046834491765983</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></div></figure>
<p>看完代码后发现是一道 $Short_padding_attack$ 结合 $Related_message_attack$ 的题目，考察对 $Coppersmith$ 算法的使用</p>
<p>首先利用 $Short_padding_attack$ 求出 $padding$ ，然后代入 $padding$ 利用 $Related_message_attack$ 求解并转回bytes即可得到flag</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">def short_pad_attack(c1, c2, e, n):</span><br><span class="line">    PRxy.&lt;x,y&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    PRx.&lt;xn&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    PRZZ.&lt;xz,yz&gt; = PolynomialRing(Zmod(n))</span><br><span class="line"></span><br><span class="line">    g1 = x^e - c1</span><br><span class="line">    g2 = (x+y)^e - c2</span><br><span class="line"></span><br><span class="line">    q1 = g1.change_ring(PRZZ)</span><br><span class="line">    q2 = g2.change_ring(PRZZ)</span><br><span class="line"></span><br><span class="line">    h = q2.resultant(q1)</span><br><span class="line">    h = h.univariate_polynomial()</span><br><span class="line">    h = h.change_ring(PRx).subs(y=xn)</span><br><span class="line">    h = h.monic()</span><br><span class="line"></span><br><span class="line">    kbits = n.nbits()//(2*e*e)</span><br><span class="line">    diff = h.small_roots(X=2^kbits, beta=0.5)[0]  # find root &lt; 2^kbits with factor &gt;= n^0.5</span><br><span class="line"></span><br><span class="line">    return diff</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">def related_message_attack(c1, c2, diff, e, n):</span><br><span class="line">    PRx.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    g1 = x^e - c1</span><br><span class="line">    g2 = (x+diff)^e - c2</span><br><span class="line"></span><br><span class="line">    def gcd(g1, g2):</span><br><span class="line">        while g2:</span><br><span class="line">            g1, g2 = g2, g1 % g2</span><br><span class="line">        return g1.monic()</span><br><span class="line"></span><br><span class="line">    return -gcd(g1, g2)[0]</span><br><span class="line"></span><br><span class="line">c1 = 25273007066020189408109545229904933542261476876009872439710113415858837573395525630415777935344105797142851844145072854811848998350900372253971849285971326186079657861753281055419024685971559366012439288855412385839773710368571132729119276524681516954047015289030441158082956015073955156160324687579087140475</span><br><span class="line">c2 = 59742662912819263048476842525911792774606722595876218353030983190479211608519746735628199156539097538888609903705813533259650335449835222582640654777700444326609516992455668845647841850293730999545553827474883338490920161461753350303815384773788647536170704446255770720919964851226435888665577313224159779663</span><br><span class="line">n = 67530919003139966773553200011128742490294797009276982165948531486788511785120120505106383097675618844859048245902703407886773958024692000896590916622934616822563863757961613349221514066937957870378716994349709221655837122691033725689519576287720351954630419028668871186060611604084354574970069046834491765983</span><br><span class="line">e = 7</span><br><span class="line">diff = short_pad_attack(c1, c2, e, n)</span><br><span class="line">flag = related_message_attack(c1, c2, diff, e, n)</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></div></figure>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag = bytes_to_long(<span class="number">59780862049663373465799351334364799719350413972042289550369773853093462961495194111494470756664785207187307066237</span>).decode</span><br></pre></td></tr></table></div></figure>
<p>flag:</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnss&#123;0x10001_getPrime_invert_pow_long_to_bytes&#125;</span><br></pre></td></tr></table></div></figure>

        <h3 id="😗-大大超人的代码Ⅲ-amp-😯-大大超人的代码Ⅳ"   >
          <a href="#😗-大大超人的代码Ⅲ-amp-😯-大大超人的代码Ⅳ" class="heading-link"><i class="fas fa-link"></i></a><a href="#😗-大大超人的代码Ⅲ-amp-😯-大大超人的代码Ⅳ" class="headerlink" title="[😗] 大大超人的代码Ⅲ &amp; [😯] 大大超人的代码Ⅳ"></a>[😗] 大大超人的代码Ⅲ &amp; [😯] 大大超人的代码Ⅳ</h3>
      <p>同一道题的两个不同难度，考察的核心是下面这个函数的计算：</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># p is a prime number, 2 &lt;= a,b &lt; p</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">a, b</span>):</span><br><span class="line">    S = <span class="built_in">set</span>()</span><br><span class="line">    prod = b</span><br><span class="line">    <span class="keyword">while</span>(prod <span class="keyword">not</span> <span class="keyword">in</span> S):</span><br><span class="line">        S.add(prod)</span><br><span class="line">        prod = prod * b % p</span><br><span class="line"></span><br><span class="line">    ret = <span class="number">1</span></span><br><span class="line">    prod = a </span><br><span class="line">    <span class="keyword">while</span>(prod <span class="keyword">not</span> <span class="keyword">in</span> S):</span><br><span class="line">        ret = ret + <span class="number">1</span></span><br><span class="line">        prod = prod * a % p</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> ret</span><br></pre></td></tr></table></div></figure>
<p>题目翻译过来就是找到最小的 $i$ 满足：</p>
<script type="math/tex; mode=display">
\exist k \ \ makes \ \ a^i = b^k \pmod{m}</script><p>一道纯数学题，用到的是数论中阶相关的知识，刚开始做的无比艰难，后面通过举例尝试得(cai)到了结果，但是还没能得到严谨证明</p>
<script type="math/tex; mode=display">
ret = \frac{ord_p(a)\times ord_p(b)}{gcd(ord_p(a),ord_p(b))}</script><p>得到公式后只需要解决求阶的问题就可以了，刚开始用的是暴力遍历 $\phi(p)$ 因数的方式来求阶，但是速度太慢了，第一题足足跑了两个小时</p>
<p>但是第二题有时间限制，就不能再用这么暴力的方法了，后面从判断原根的算法中得到启发，通过筛选去除质因数的方法来求阶：</p>
<p>遍历 $\phi(p)$ 的质因数 $p_i$ ，若 $a^\frac{\phi(p)}{p_i}\not=1$ ，则 $p_i$ 不是 $ord_p(a)$ 的质因数，将 $\phi(p)$ 其从中除去，最后剩下的就是 $ord_p(a)$ . 具体代码实现如下：</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">find</span>(<span class="params">a, lst, p</span>):</span><br><span class="line">    <span class="comment"># start = time.perf_counter()</span></span><br><span class="line">    order = p - <span class="number">1</span></span><br><span class="line">    order_list = []</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> lst:</span><br><span class="line">        order_list.append(k)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(order_list)):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> order_list:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> order_list:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">pow</span>(a, order // i, p) == <span class="number">1</span>:</span><br><span class="line">                order = order // i</span><br><span class="line">                <span class="keyword">del</span> order_list[<span class="number">0</span>]</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                order_list.remove(i)</span><br><span class="line">    <span class="comment"># end = time.process_time()</span></span><br><span class="line">    <span class="comment"># print(f&#x27;Running time: &#123;end - start&#125; Seconds&#x27;)</span></span><br><span class="line">    <span class="keyword">return</span> order</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">a, b, order_list, p</span>):</span><br><span class="line">    a1 = find(a, order_list, p)</span><br><span class="line">    b1 = find(b, order_list, p)</span><br><span class="line">    ret = a1 // gcd(a1, b1)</span><br><span class="line">    <span class="built_in">print</span>(ret)</span><br><span class="line">    <span class="keyword">return</span> ret</span><br></pre></td></tr></table></div></figure>
<p>经测试，代码平均用时在0.01-0.02s左右，成果解决第二题</p>
<p>不过好像还存在一点小bug😢，因为我解决掉第二题之后用这个算法去解决第一题时最后结果不太对劲，而且跑出来的结果有时候还不一样，但是由于时间问题还没仔细找问题出在哪，后面有时间了再看一看，找师傅要证明的时候可以问一问</p>
<p>最后给出两道题的flag</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnss&#123;490340709191995056161967738&#125;</span><br></pre></td></tr></table></div></figure>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnss&#123;ACM_L1mit5_My_Im@ginati0n&#125;</span><br></pre></td></tr></table></div></figure>

        <h3 id="👿-CNSS-Crypto-Service"   >
          <a href="#👿-CNSS-Crypto-Service" class="heading-link"><i class="fas fa-link"></i></a><a href="#👿-CNSS-Crypto-Service" class="headerlink" title="[👿]CNSS Crypto Service"></a>[👿]CNSS Crypto Service</h3>
      <p>BOSS题来辣！</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">from</span> ocb <span class="keyword">import</span> OCB</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> urandom</span><br><span class="line"><span class="keyword">import</span> socketserver</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> Crypto <span class="keyword">import</span> Random</span><br><span class="line"></span><br><span class="line">BS = <span class="number">16</span></span><br><span class="line">FLAG=<span class="string">b&#x27;cnss&#123;..........................................&#125;&#x27;</span></span><br><span class="line"><span class="keyword">assert</span>(<span class="built_in">len</span>(FLAG) == <span class="number">48</span>)</span><br><span class="line"></span><br><span class="line">BANNER=<span class="string">br&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Welcome to CNSS Crypto Service! </span></span><br><span class="line"><span class="string">  ____ _   _ ____ ____ </span></span><br><span class="line"><span class="string"> / ___| \ | / ___/ ___| </span></span><br><span class="line"><span class="string">| |   |  \| \___ \___ \ </span></span><br><span class="line"><span class="string">| |___| |\  |___) |__) |</span></span><br><span class="line"><span class="string"> \____|_| \_|____/____/ </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">All the string variables you send/recieve should/would be in hex form and be n * 16 bytes.</span></span><br><span class="line"><span class="string">For example, 65392825175610104412735799271089255734</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">MENU = <span class="string">br&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">[1] Encrypt</span></span><br><span class="line"><span class="string">[2] Decrypt</span></span><br><span class="line"><span class="string">[3] Show Encryption History</span></span><br><span class="line"><span class="string">[4] Exit</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pad</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="keyword">return</span> s + (BS - <span class="built_in">len</span>(s) % BS) * long_to_bytes(BS - <span class="built_in">len</span>(s) % BS) </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">unpad</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="keyword">return</span> s[<span class="number">0</span>:-s[-<span class="number">1</span>]]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">col</span>(<span class="params">a, c</span>):</span><br><span class="line">    <span class="keyword">return</span> [a[i][c] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(a))]</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Scheme</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,key</span>):</span><br><span class="line">        self.key = key</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">self,raw</span>):</span><br><span class="line">        raw = pad(raw)</span><br><span class="line">        raw = md5(raw).digest() + raw</span><br><span class="line"></span><br><span class="line">        iv = Random.new().read(BS)</span><br><span class="line">        cipher = AES.new(self.key,AES.MODE_CBC,iv)</span><br><span class="line">        <span class="keyword">return</span> (iv + cipher.encrypt(raw)).<span class="built_in">hex</span>().encode()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">self,enc</span>):</span><br><span class="line">        enc = <span class="built_in">bytes</span>.fromhex(enc.decode())</span><br><span class="line"></span><br><span class="line">        iv = enc[:BS]</span><br><span class="line">        enc = enc[BS:]</span><br><span class="line"></span><br><span class="line">        cipher = AES.new(self.key,AES.MODE_CBC,iv)</span><br><span class="line">        blob = cipher.decrypt(enc)</span><br><span class="line"></span><br><span class="line">        checksum = blob[:BS]</span><br><span class="line">        data = blob[BS:]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> md5(data).digest() == checksum:</span><br><span class="line">            <span class="keyword">return</span> unpad(data)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Task</span>(socketserver.BaseRequestHandler):</span><br><span class="line">    encrypt_history = []</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, *args, **kargs</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(*args, **kargs)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_recvall</span>(<span class="params">self</span>):</span><br><span class="line">        BUFF_SIZE = <span class="number">2048</span></span><br><span class="line">        data = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            part = self.request.recv(BUFF_SIZE)</span><br><span class="line">            data += part</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(part) &lt; BUFF_SIZE:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">return</span> data.strip()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send</span>(<span class="params">self, msg, newline=<span class="literal">True</span></span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">type</span>(msg)==<span class="built_in">str</span>: msg=msg.encode()</span><br><span class="line">            <span class="keyword">if</span> newline: msg += <span class="string">b&#x27;\n&#x27;</span></span><br><span class="line">            self.request.sendall(msg)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">recv</span>(<span class="params">self, text, prompt=<span class="string">b&#x27;&gt; &#x27;</span></span>):</span><br><span class="line">        self.send(text, newline=<span class="literal">False</span>)</span><br><span class="line">        self.send(prompt, newline=<span class="literal">False</span>)</span><br><span class="line">        <span class="keyword">return</span> self._recvall()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">recvhex</span>(<span class="params">self, text, prompt=<span class="string">b&#x27;&gt; &#x27;</span></span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>.fromhex(self.recv(text, prompt=prompt).decode(<span class="string">&#x27;latin-1&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">timeout_handler</span>(<span class="params">self, signum, frame</span>):</span><br><span class="line">        <span class="keyword">raise</span> TimeoutError</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">self, ocb</span>):</span><br><span class="line">        N = self.recvhex(<span class="string">b&#x27;nonce&#x27;</span>)</span><br><span class="line">        M = self.recvhex(<span class="string">b&#x27;plain&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> N <span class="keyword">in</span> col(self.encrypt_history, <span class="number">0</span>) <span class="keyword">or</span> M <span class="keyword">in</span> col(self.encrypt_history, <span class="number">0</span>) <span class="keyword">or</span> N==M:</span><br><span class="line">            self.send(<span class="string">&#x27;Illegal Encryption Request!&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span>()</span><br><span class="line">        </span><br><span class="line">        C, T = ocb.encrypt(N, M)</span><br><span class="line">        self.encrypt_history.append([N, C, T])</span><br><span class="line">        self.send(<span class="string">f&#x27;cipher: <span class="subst">&#123;C.<span class="built_in">hex</span>()&#125;</span>&#x27;</span>)</span><br><span class="line">        self.send(<span class="string">f&#x27;tag: <span class="subst">&#123;T.<span class="built_in">hex</span>()&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">self, ocb</span>):</span><br><span class="line">        N = self.recvhex(<span class="string">b&#x27;nonce&#x27;</span>)</span><br><span class="line">        C = self.recvhex(<span class="string">b&#x27;cipher&#x27;</span>)</span><br><span class="line">        T = self.recvhex(<span class="string">b&#x27;tag&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> C <span class="keyword">in</span> col(self.encrypt_history, <span class="number">1</span>):</span><br><span class="line">            self.send(<span class="string">&#x27;Illegal Decryption Request!&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span>()</span><br><span class="line">        auth, M = ocb.decrypt(N, C, T)</span><br><span class="line">        self.send(<span class="string">f&#x27;auth: <span class="subst">&#123;auth&#125;</span>&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> auth:</span><br><span class="line">            self.send(<span class="string">f&#x27;plain: <span class="subst">&#123;M.<span class="built_in">hex</span>()&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">serve</span>(<span class="params">self, isAdmin = <span class="literal">False</span></span>):</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            self.send(MENU, newline = <span class="literal">False</span>)</span><br><span class="line">            option = <span class="built_in">int</span>(self.recv(<span class="string">&#x27;&#x27;</span>))</span><br><span class="line">            <span class="keyword">if</span> option == <span class="number">1</span>:</span><br><span class="line">                self.encrypt(self.ocb)</span><br><span class="line">            <span class="keyword">elif</span> option == <span class="number">2</span>:</span><br><span class="line">                self.decrypt(self.ocb)</span><br><span class="line">            <span class="keyword">elif</span> option == <span class="number">3</span>:</span><br><span class="line">                <span class="keyword">if</span> isAdmin:</span><br><span class="line">                    <span class="keyword">for</span> record <span class="keyword">in</span> self.encrypt_history:</span><br><span class="line">                        self.send(<span class="string">&quot;#&quot;</span>*<span class="number">20</span>)</span><br><span class="line">                        self.send(<span class="string">f&#x27;nonce: <span class="subst">&#123;record[<span class="number">0</span>].<span class="built_in">hex</span>()&#125;</span>&#x27;</span>)</span><br><span class="line">                        self.send(<span class="string">f&#x27;cipher: <span class="subst">&#123;record[<span class="number">1</span>].<span class="built_in">hex</span>()&#125;</span>&#x27;</span>)</span><br><span class="line">                        self.send(<span class="string">f&#x27;tag: <span class="subst">&#123;record[<span class="number">2</span>].<span class="built_in">hex</span>()&#125;</span>&#x27;</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    self.send(<span class="string">&quot;Permission Denied! Only admin can use this option.&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">self</span>):</span><br><span class="line">        key = Random.new().read(BS)</span><br><span class="line">        scheme = Scheme(key)</span><br><span class="line">        self.ocb = OCB(urandom(<span class="number">16</span>))</span><br><span class="line">        N = urandom(<span class="number">16</span>)</span><br><span class="line">        C, T = self.ocb.encrypt(N, FLAG)</span><br><span class="line">        self.encrypt_history.append([N, C, T])</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            self.send(<span class="string">&quot;Please [r]egister or [l]ogin&quot;</span>)</span><br><span class="line">            cmd = self.recv(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> cmd == <span class="string">b&#x27;r&#x27;</span>:</span><br><span class="line">                name = self.recv(<span class="string">&quot;username&quot;</span>)</span><br><span class="line">                <span class="keyword">if</span>(<span class="built_in">len</span>(name) &gt; <span class="number">32</span>):</span><br><span class="line">                    self.send(<span class="string">b&#x27;Username too long!&#x27;</span>)</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">if</span> pad(name) == pad(<span class="string">b&#x27;admin&#x27;</span>):</span><br><span class="line">                    self.send(<span class="string">b&#x27;You cannot use this name!&#x27;</span>)</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    self.send(<span class="string">b&#x27;Here is your token:&#x27;</span>)</span><br><span class="line">                    self.send(scheme.encrypt(name))</span><br><span class="line">            <span class="keyword">elif</span> cmd == <span class="string">b&#x27;l&#x27;</span>:</span><br><span class="line">                data = self.recv(<span class="string">&quot;token&quot;</span>)</span><br><span class="line">                <span class="keyword">try</span>: </span><br><span class="line">                    name = scheme.decrypt(data)</span><br><span class="line">                <span class="keyword">except</span>: </span><br><span class="line">                    self.send(<span class="string">&quot;Illegal Token!&quot;</span>)</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">if</span> name == <span class="string">b&#x27;admin&#x27;</span>:</span><br><span class="line">                    self.send(<span class="string">b&#x27;Welcome admin!&#x27;</span>)</span><br><span class="line">                    self.serve(<span class="literal">True</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    self.send(<span class="string">f&#x27;Welcome <span class="subst">&#123;name.decode()&#125;</span>!&#x27;</span>)</span><br><span class="line">                    self.serve()</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.send(<span class="string">b&#x27;Unknown cmd!&#x27;</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.send(BANNER)</span><br><span class="line">            self.login()</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            self.send(<span class="string">b&#x27;What\&#x27;s wrong???&#x27;</span>)</span><br><span class="line">            self.request.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ThreadedServer</span>(socketserver.ForkingMixIn, socketserver.TCPServer):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">HOST, PORT = <span class="string">&#x27;47.113.199.200&#x27;</span>, <span class="number">20000</span></span><br><span class="line">server = ThreadedServer((HOST, PORT), Task)</span><br><span class="line">server.allow_reuse_address = <span class="literal">True</span></span><br><span class="line">server.serve_forever()</span><br></pre></td></tr></table></div></figure>
<p>题目有两个考察点</p>
<p>第一个是利用 $AES-CBC$ 翻转攻击来伪造 $token$ 登录 $admin$ ，进而获取 $flag$ 经过 $OCB2$ 加密后得到的 $nonce、cipher、tag$</p>
<p>第二个是 $OCB2$ 的 $Plaintext\ Recovery$ ，因为我们并不能直接利用系统的 $decrypt$ 来进行解密，所以就需要通过一系列构造来绕过限制条件进行解密</p>
<p>首先是 $AES-CBC$ 翻转攻击</p>
<p>在<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.xctf.org.cn/library/details/65f4adfaa1802e6575625492d5bc59f6f740c666/" >0CTF2017</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>找到了一道类似的题目，大致思想就是利用 $AES-CBC$ 分组加密并且每一组的加密依靠的是上一组密文的特性来进行伪造</p>
<p>以 $admin$ 身份登录后取得 $nonce、cipher、tag$ </p>
<p>接下来就要用到 $OCB2$ 的 $Plaintext\ Recovery$ </p>
<p>最初找到了一篇论文<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://eprint.iacr.org/2018/1090.pdf" >Plaintext Recovery Attack of OCB2</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>和一道类似的题<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://blog.react0r.com/2019/12/06/cryptography-attacking-ocb2/" >Cryptography: Attacking OCB2 – react0r blog</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>，看完后基本上已经有了思路，然后利用<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://github.com/oalieno/OCB2-POC" >github</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>上找到的代码成功解决</p>
<p>最后的解题代码有点小bug，sendline发的太快容易导致顺序错乱，还没来得及解决，暂时用调试顶替了一下。</p>
<p>完整代码如下：</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> block <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pad</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="keyword">return</span> s + (BS - <span class="built_in">len</span>(s) % BS) * long_to_bytes(BS - <span class="built_in">len</span>(s) % BS)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bxor</span>(<span class="params">b1, b2</span>): <span class="comment"># use xor for bytes</span></span><br><span class="line">    parts = []</span><br><span class="line">    <span class="keyword">for</span> b1, b2 <span class="keyword">in</span> <span class="built_in">zip</span>(b1, b2):</span><br><span class="line">        parts.append(<span class="built_in">bytes</span>([b1 ^ b2]))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&#x27;&#x27;</span>.join(parts)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login_as_admin</span>():</span><br><span class="line">    <span class="comment"># login as admin</span></span><br><span class="line">    p.sendline(<span class="string">b&#x27;r&#x27;</span>)</span><br><span class="line">    p.sendline(md5(pad(<span class="string">b&#x27;admin&#x27;</span>)).digest() + <span class="string">b&#x27;admin&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(md5(pad(<span class="string">b&#x27;admin&#x27;</span>)).digest() + <span class="string">b&#x27;admin&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    recv = p.recvline().decode()</span><br><span class="line">    <span class="built_in">print</span>(recv.strip())</span><br><span class="line">    recv = p.recvline().decode()</span><br><span class="line">    <span class="built_in">print</span>(recv.strip())</span><br><span class="line">    token = recv.strip()</span><br><span class="line">    <span class="built_in">print</span>(token.encode())</span><br><span class="line">    mytoken = token[<span class="number">32</span>:]</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">len</span>(mytoken), <span class="built_in">type</span>(mytoken))</span><br><span class="line">    recv = p.recvline().decode()</span><br><span class="line">    <span class="built_in">print</span>(recv.strip())</span><br><span class="line"></span><br><span class="line">    p.sendline(<span class="string">b&#x27;l&#x27;</span>)</span><br><span class="line">    p.sendline(mytoken.encode())</span><br><span class="line">    recv = p.recvline().decode()</span><br><span class="line">    <span class="built_in">print</span>(recv.strip())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_NCT</span>():</span><br><span class="line">    p.sendline(<span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">    recv = p.recvline().decode()</span><br><span class="line">    <span class="built_in">print</span>(recv.strip())</span><br><span class="line">    recv = p.recvline().decode()</span><br><span class="line">    <span class="built_in">print</span>(recv.strip())</span><br><span class="line">    nonce = Block(<span class="built_in">bytes</span>.fromhex(recv[<span class="number">7</span>:]))</span><br><span class="line">    recv = p.recvline().decode()</span><br><span class="line">    <span class="built_in">print</span>(recv.strip())</span><br><span class="line">    cipher = Block(<span class="built_in">bytes</span>.fromhex(recv[<span class="number">8</span>:]))</span><br><span class="line">    recv = p.recvline().decode()</span><br><span class="line">    <span class="built_in">print</span>(recv.strip())</span><br><span class="line">    tag = Block(<span class="built_in">bytes</span>.fromhex(recv[<span class="number">5</span>:]))</span><br><span class="line">    <span class="keyword">return</span> nonce, cipher, tag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">nonce, message</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        recv = p.recvline().decode()</span><br><span class="line">        <span class="built_in">print</span>(recv.strip())</span><br><span class="line">    p.sendline(<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">    p.sendline(nonce.encode())</span><br><span class="line">    p.sendline(message.encode())</span><br><span class="line">    recv = p.recvline().decode()</span><br><span class="line">    <span class="built_in">print</span>(recv.strip())</span><br><span class="line">    <span class="built_in">print</span>(recv[<span class="number">24</span>:])</span><br><span class="line">    cipher = Block(<span class="built_in">bytes</span>.fromhex(recv[<span class="number">24</span>:]))</span><br><span class="line">    recv = p.recvline().decode()</span><br><span class="line">    <span class="built_in">print</span>(recv.strip())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;tag = &#x27;</span> + recv[<span class="number">5</span>:])</span><br><span class="line">    tag = Block(<span class="built_in">bytes</span>.fromhex(recv[<span class="number">5</span>:]))</span><br><span class="line">    <span class="keyword">return</span> cipher, tag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">nonce, cipher, tag</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;begin decrypt&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        recv = p.recvline().decode()</span><br><span class="line">        <span class="built_in">print</span>(recv.strip())</span><br><span class="line">    p.sendline(<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">    p.sendline(nonce.encode())</span><br><span class="line">    p.sendline(cipher.encode())</span><br><span class="line">    p.sendline(tag.encode())</span><br><span class="line">    recv = p.recvline().decode()</span><br><span class="line">    <span class="built_in">print</span>(recv.strip())</span><br><span class="line">    recv = p.recvline().decode()</span><br><span class="line">    <span class="built_in">print</span>(recv.strip())</span><br><span class="line">    plain = Block(<span class="built_in">bytes</span>.fromhex(recv[<span class="number">7</span>:]))</span><br><span class="line">    <span class="keyword">return</span> plain</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">randomMapping</span>(<span class="params">n</span>):</span><br><span class="line">    N = Block.random(<span class="number">16</span>)</span><br><span class="line">    M = Block.random(n * <span class="number">16</span>) + Block.<span class="built_in">len</span>(<span class="number">16</span>) + Block.random(<span class="number">16</span>)</span><br><span class="line">    C, T = encrypt(N.<span class="built_in">hex</span>(), M.<span class="built_in">hex</span>())</span><br><span class="line"></span><br><span class="line">    S = Block.zero()</span><br><span class="line">    C_ = Block()</span><br><span class="line">    T_ = M[n + <span class="number">1</span>] ^ C[n + <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        C_ += C[i]</span><br><span class="line">        S ^= M[i]</span><br><span class="line">    C_ += (S ^ C[n] ^ Block.<span class="built_in">len</span>(<span class="number">16</span>))</span><br><span class="line">    M_ = decrypt(N.<span class="built_in">hex</span>(), C_.<span class="built_in">hex</span>(), T_.<span class="built_in">hex</span>())</span><br><span class="line">    <span class="comment"># assert auth</span></span><br><span class="line"></span><br><span class="line">    S = Block.zero()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        S ^= M[i]</span><br><span class="line">    L = (S ^ M_[n] ^ Block.<span class="built_in">len</span>(<span class="number">16</span>)).half(n + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    mappings = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        mappings.append((M[i] ^ L.double(i + <span class="number">1</span>), C[i] ^ L.double(i + <span class="number">1</span>)))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> mappings</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">specificMapping</span>(<span class="params">Is</span>):</span><br><span class="line">    N, L = randomMapping(<span class="number">1</span>)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    n = <span class="built_in">len</span>(Is)</span><br><span class="line">    M = Block()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        M += (Is[i] ^ L.double(i + <span class="number">1</span>))</span><br><span class="line">    M += Block.zero()</span><br><span class="line">    C, T = encrypt(N.<span class="built_in">hex</span>(), M.<span class="built_in">hex</span>())</span><br><span class="line"></span><br><span class="line">    Os = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        Os.append(C[i] ^ L.double(i + <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">recovery</span>(<span class="params">N, C, T</span>):</span><br><span class="line">    L = specificMapping([N])[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    n = C.blocksize()</span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">1</span>:</span><br><span class="line">        Y = specificMapping([Block.<span class="built_in">len</span>(<span class="number">16</span>) ^ L.double()])</span><br><span class="line">        M_ = Y[<span class="number">0</span>] ^ C[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">elif</span> n == <span class="number">2</span>:</span><br><span class="line">        Y = specificMappingInv([C[<span class="number">0</span>] ^ L.double()])</span><br><span class="line">        M_ = Y[<span class="number">0</span>] ^ L.double()</span><br><span class="line">        Y = specificMapping([Block.<span class="built_in">len</span>(<span class="number">16</span>) ^ L.double(<span class="number">2</span>)])</span><br><span class="line">        M_ += Y[<span class="number">0</span>] ^ C[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        L_ = L.double() ^ L.double(<span class="number">2</span>)</span><br><span class="line">        C[<span class="number">0</span>], C[<span class="number">1</span>] = C[<span class="number">1</span>] ^ L_, C[<span class="number">0</span>] ^ L_</span><br><span class="line">        M_ = decrypt(N.<span class="built_in">hex</span>(), C.<span class="built_in">hex</span>(), T.<span class="built_in">hex</span>())</span><br><span class="line">        M_[<span class="number">0</span>], M_[<span class="number">1</span>] = M_[<span class="number">1</span>] ^ L_, M_[<span class="number">0</span>] ^ L_</span><br><span class="line">    <span class="keyword">return</span> M_</span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&#x27;47.113.199.200&#x27;</span>, <span class="number">20000</span>)</span><br><span class="line">BS = <span class="number">16</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># receive BANNER</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">12</span>):</span><br><span class="line">    recv = p.recvline().decode()</span><br><span class="line">    <span class="built_in">print</span>(recv.strip())</span><br><span class="line"></span><br><span class="line">login_as_admin()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    recv = p.recvline().decode()</span><br><span class="line">    <span class="built_in">print</span>(recv.strip())</span><br><span class="line"></span><br><span class="line">N, C, T = get_NCT()</span><br><span class="line"></span><br><span class="line">flag = recovery(N, C, T)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(flag.<span class="built_in">hex</span>()).decode())</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>
<p>最后得到flag:</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnss&#123;0CB2_1S_N0t_S3cUR3__US3_OcB3_1NST34D!!!!!!&#125;</span><br></pre></td></tr></table></div></figure>
</div><footer class="post-footer"><div class="post-ending ending"><div class="ending__text">------ 本文结束，感谢您的阅读 ------</div></div><div class="post-copyright copyright"><div class="copyright-author"><span class="copyright-author__name">本文作者: </span><span class="copyright-author__value"><a href="https://freeman-cc.github.io">Cc</a></span></div><div class="copyright-link"><span class="copyright-link__name">本文链接: </span><span class="copyright-link__value"><a href="https://freeman-cc.github.io/2022/04/10/CNSS%E6%8B%9B%E6%96%B0%E9%A2%98-2021-crypto-writeup/">https://freeman-cc.github.io/2022/04/10/CNSS%E6%8B%9B%E6%96%B0%E9%A2%98-2021-crypto-writeup/</a></span></div><div class="copyright-notice"><span class="copyright-notice__name">版权声明: </span><span class="copyright-notice__value">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" rel="external nofollow" target="_blank">BY-NC-SA</a> 许可协议。转载请注明出处！</span></div></div><div class="post-tags"><span class="post-tags-item"><span class="post-tags-item__icon"><i class="fas fa-tag"></i></span><a class="post-tags-item__link" href="https://freeman-cc.github.io/tags/Crypto/">Crypto</a></span></div><nav class="post-paginator paginator"><div class="paginator-next"><a class="paginator-next__link" href="/2022/04/10/Aegis%E6%8B%9B%E6%96%B0%E9%A2%98-crypto-writeup/"><span class="paginator-prev__text">Aegis招新题-crypto-writeup</span><span class="paginator-next__icon"><i class="fas fa-angle-right"></i></span></a></div></nav></footer></div></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><div class="sidebar-nav"><span class="sidebar-nav-toc current">文章目录</span><span class="sidebar-nav-ov">站点概览</span></div><section class="sidebar-toc"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#CNSS%E6%8B%9B%E6%96%B0%E9%A2%98-crypto-writeup"><span class="toc-number">1.</span> <span class="toc-text">
          CNSS招新题-crypto-writeup</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%98%8B-%E5%A4%A7%E5%A4%A7%E8%B6%85%E4%BA%BA%E7%9A%84%E4%BB%A3%E7%A0%81-I"><span class="toc-number">1.0.1.</span> <span class="toc-text">
          [😋] 大大超人的代码 I</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%98%8B-%E5%A4%A7%E5%A4%A7%E8%B6%85%E4%BA%BA%E7%9A%84%E4%BB%A3%E7%A0%81-II"><span class="toc-number">1.0.2.</span> <span class="toc-text">
          [😋] 大大超人的代码 II</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%98%8B-EZRSA"><span class="toc-number">1.0.3.</span> <span class="toc-text">
          [😋] EZRSA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%98%8B-True-Random"><span class="toc-number">1.0.4.</span> <span class="toc-text">
          [😋] True Random</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%98%8B-%E5%9F%BA%E5%9C%B0%E9%81%AD%E5%88%B0%E6%94%BB%E5%87%BB"><span class="toc-number">1.0.5.</span> <span class="toc-text">
          [😋] 基地遭到攻击</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%98%8B-%F0%9F%98%97-2-Smooth-Criminal"><span class="toc-number">1.0.6.</span> <span class="toc-text">
          [(😋+😗)&#x2F;2] Smooth Criminal</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%98%97-ECDLP"><span class="toc-number">1.0.7.</span> <span class="toc-text">
          [😗] ECDLP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%98%97-%E9%82%A3%E4%B8%AA%E7%94%B7%E4%BA%BA%EF%BC%81%EF%BC%81%EF%BC%81"><span class="toc-number">1.0.8.</span> <span class="toc-text">
          [😗] 那个男人！！！</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%98%97-RSA-I"><span class="toc-number">1.0.9.</span> <span class="toc-text">
          [😗] RSA I</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%98%AF-RSA-II"><span class="toc-number">1.0.10.</span> <span class="toc-text">
          [😯] RSA II</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%98%97-%E5%A4%A7%E5%A4%A7%E8%B6%85%E4%BA%BA%E7%9A%84%E4%BB%A3%E7%A0%81%E2%85%A2-amp-%F0%9F%98%AF-%E5%A4%A7%E5%A4%A7%E8%B6%85%E4%BA%BA%E7%9A%84%E4%BB%A3%E7%A0%81%E2%85%A3"><span class="toc-number">1.0.11.</span> <span class="toc-text">
          [😗] 大大超人的代码Ⅲ &amp; [😯] 大大超人的代码Ⅳ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%F0%9F%91%BF-CNSS-Crypto-Service"><span class="toc-number">1.0.12.</span> <span class="toc-text">
          [👿]CNSS Crypto Service</span></a></li></ol></li></ol></li></ol></section><!-- ov = overview--><section class="sidebar-ov hide"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="/images/icons/stun-logo.svg" alt="avatar"></div><p class="sidebar-ov-author__text">hello world</p></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">4</div><div class="sidebar-ov-state-item__name">归档</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--tags" href="/tags/"><div class="sidebar-ov-state-item__count">1</div><div class="sidebar-ov-state-item__name">标签</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="知识共享许可协议" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section><div class="sidebar-reading"><div class="sidebar-reading-info"><span class="sidebar-reading-info__text">你已阅读了 </span><span class="sidebar-reading-info__num">0</span><span class="sidebar-reading-info__perc">%</span></div><div class="sidebar-reading-line"></div></div></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright © 2022</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>Cc</span></div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script type="text/x-mathjax-config">var mathjaxMhchem = '';
var mathJaxTex = {
  equationNumbers: {
    autoNumber: 'AMS'
  }
};

if (false) {
  mathjaxMhchem = 'https://cdn.jsdelivr.net/npm/mathjax-mhchem@3.3.2/mhchem.min.js';
  MathJax.Ajax.config.path['mhchem'] = mathjaxMhchem;

  mathJaxTex.extensions = [mathjaxMhchem];
} else {
  mathJaxTex.extensions = ['AMSmath.js','AMSsymbols.js'];
}

MathJax.Hub.Config({
  menuSettings: {
    zoom: 'None'
  },
  showMathMenu: false,
  jax: ['input/TeX','output/CommonHTML'],
  extensions: ['tex2jax.js'],
  TeX: mathJaxTex,
  tex2jax: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['\\[', '\\]']],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  }
});

MathJax.Hub.Register.StartupHook('TeX Jax Ready', function() {
  MathJax.InputJax.TeX.prefilterHooks.Add(function(data) {
    if (data.display) {
      var next = data.script.nextSibling;
      while (next && next.nodeName.toLowerCase() === '#text') { next = next.nextSibling; }
      if (next && next.nodeName.toLowerCase() === 'br') { next.parentNode.removeChild(next); }
    }
  });
});

MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i = 0; i < all.length; i++) {
    document.getElementById(all[i].inputID + '-Frame').parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.jsdelivr.net/npm/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script src="/js/utils.js?v=2.6.2"></script><script src="/js/stun-boot.js?v=2.6.2"></script><script src="/js/scroll.js?v=2.6.2"></script><script src="/js/header.js?v=2.6.2"></script><script src="/js/sidebar.js?v=2.6.2"></script></body></html>